/* Last Update: Wed, 14 Apr 2021 08:49:31 GMT */
/* CUSTOMER_NAME */
/* Do not load Segmentify more than one to prevent potential error occurrence */
if (window['SegmentifyTrackingObject'] === "Segmentify") {
  //throw new Error("Segmentify is already loaded!");
} else {

  var segNamespace = "Segmentify";

  window['SegmentifyTrackingObject'] = segNamespace;

  window[segNamespace] = window[segNamespace] || function () {
    (window[segNamespace].q = window[segNamespace].q || []).push(arguments);
  };

  window[segNamespace].config = {
    segmentifyApiUrl: '//gandalf-eu.segmentify.com/',
    domain: '.elefant.ro'
  };

  Segmentify('apikey', '732d8f2b-6c40-4878-851e-f8beace5d405');

  function waitSegmentifyAndjQuery() {
    if (window["_SgmntfY_"] && window["_SgmntfY_"]._getJq()) {
      window.segJquery = window["_SgmntfY_"]._getJq();

      segJquery(document).ready(function () {
        SegmentifyIntegration(window.segJquery).init();
      });
    } else {
      setTimeout(waitSegmentifyAndjQuery, 100);
    }
  }

  var SegmentifyIntegration = function (jQuery) {
    var segmentifyEvents = {
      viewPage: function (category, subCategory, params) {
        /* console.log("Pageview Event is going", pageVariables.category, pageVariables.subCategory); */
        Segmentify('view:page', {
          'category': category,
          'subCategory': subCategory,
          'params': params
        });
      },
      viewProduct: function (productObj) {
        /* console.log("Product View Event is going", productObj); */
        Segmentify('view:product', productObj);
      },
      checkoutBasket: function (basketObj) {
        /* console.log("Checkout Basket event is going", basketObj); */
        Segmentify('checkout:basket', basketObj);
      },
      checkoutPurchase: function (purchaseObj) {
        /* console.log("Checkout Purchase event is going", purchaseObj); */
        Segmentify('checkout:purchase', purchaseObj);
      },
      basketAdd: function (basketObj) {
        /* console.log("Basket Add Event is going", basketObj); */
        Segmentify('basket:add', basketObj);
      },
      basketRemove: function (basketObj) {
        /* console.log("Basket Remove Event is going", basketObj); */
        Segmentify('basket:remove', basketObj);
      },
      basketClear: function (basketObj) {
        /* console.log("Basket Clear Event is going", basketObj); */
        Segmentify('basket:clear', basketObj);
      },
      userUpdate: function (userObj) {
        /* console.log("User Update Event is going", userObj); */
        Segmentify('user:update', userObj);
      },
      userId: function (id) {
        /* console.log("User ID is going to be changed", id); */
        Segmentify('userid', id);
      },
      custom: function (customObj) {
        /* console.log("Custom Event is going", customObj); */
        Segmentify('event:custom', customObj);
      },
      error: function (errorMessage) {
        Segmentify('event:custom', {
          "type": "error_handler",
          "params": {
            "errorMessage": errorMessage.toString(),
            "nextPage": false
          }
        });
      }
    };

    var helperFunctions = {
      "setCookie": function (cname, cvalue, exdays) {
        window["_SgmntfY_"]._storePersistentData(cname, cvalue, exdays, false);
      },
      "getCookie": function (cname) {
        return window["_SgmntfY_"]._getPersistentData(cname, false);
      },
      "getQueryParameter": function (pname, url) {
        return window["_SgmntfY_"]._getQueryParameter(pname, url);
      },
      "priceFormatter": function (price, separators, currency_symbol) {
        try {
          var temp = price;

          if (temp) {
            // if separators provided, replace them
            var allowedChars = "0123456789.,";

            for (var i = 0; i < price.length; i++) {
              if (allowedChars.indexOf(price[i]) < 0) {
                temp = temp.replace(price[i], "");
              }
            }
            if (separators && Array.isArray(separators) && separators.length === 2) {
              var regexPattern = "";
              var regex = null;

              if (separators[1]) {
                regexPattern = "\\" + separators[1];
                regex = new RegExp(regexPattern, "g");

                temp = temp.replace(regex, "");
              }

              if (separators[0]) {
                regexPattern = "\\" + separators[0];
                regex = new RegExp(regexPattern, "g");

                temp = temp.replace(regex, separators[1]);
              }
            }

            // if currency symbol is valid and has a string value, replace it
            if (currency_symbol && typeof currency_symbol === "string") {
              temp = temp.replace(currency_symbol, "");
            }

            // cast the price to float
            temp = parseFloat(temp.toString().trim().replace(/\s/g, "")).toFixed(2);

            return temp;
          }

          // if given parameters are not valid, return zero
          return 0;
        } catch (err) {
          // if any error occurs, return zero
          return 0;
        }
      },
      "findPropertyInArray": function (prop, arr, isLast) {
        try {
          // if property is not defined or empty string or array is empty exit function
          if (typeof prop !== "string" ||
            !prop ||
            !Array.isArray(arr)) {
            return null;
          }

          var findings = [];

          for (var i = 0; i < arr.length; i++) {
            var arr_item = arr[i];

            // if this array object contains property -prop-, so this is what we are looking for
            if (arr_item.hasOwnProperty(prop)) {
              findings.push(arr_item);
            }
          }

          if (isLast && findings.length) {
            return findings[findings.length - 1];
          } else if (findings.length) {
            return findings[0];
          }

          return null;
        } catch (err) {
          // prevent unexpected return type so return null
          return null;
        }
      },
      "findProductById": function (id, products) {
        try {
          // check if products is an array and id is a valid value, if not return empty object
          if (!id ||
            !products ||
            (typeof id !== "number" && typeof id !== "string") ||
            !Array.isArray(products)) {
            return {};
          }

          // walk through the products array, if ids match return the product
          for (var i = 0; i < products.length; i++) {
            if (products[i]["productId"].toString().trim() === id.toString().trim()) {
              return products[i];
            }
          }

          // if nothing was found, return empty object
          return {};
        } catch (err) {
          // if unexpected things happen, return empty object
          return {};
        }
      }
    };

    var pageVariables = {
      category: "",
      subCategory: "",
      params: {}
    };

    var findPageType = function () {
      try {
        /* Home Page, Category Page, Product Page, Basket Page, Search Page, Checkout Success Page */
        if (jQuery("body").hasClass("homepage")) {
          pageVariables.category = "Home Page";

          return;
        }

        if (document.location.pathname.indexOf("/search") === 0) {
          pageVariables.category = "Search Page";
          pageVariables.subCategory = "";
          pageVariables.params["squery"] = document.location.href.split("?SearchTerm=")[1];

          return;
        }

        if (jQuery("body").hasClass("family-page")) {
          pageVariables.category = "Category Page";

          var pageCat = [];
          jQuery("li.breadcrumbs-list:not(:first)").each(function () {
            pageCat.push(jQuery(this).text().replace(/\//g, "").trim());
          });

          pageVariables.subCategory = pageCat.join(" > ");

          return;
        }

        if (jQuery("body").hasClass("product-detail-page")) {
          pageVariables.category = "Product Page";
          pageVariables.subCategory = "";

          return;
        }

        if (jQuery("body").hasClass("cart-page") || document.location.pathname.indexOf("/cart/") > -1) {
          pageVariables.category = "Basket Page";

          return;
        }

        if (jQuery("body").attr("class") === "errorpage") {
          pageVariables.category = "404 Page";
          return;
        }

        if (jQuery("#checkout").length > 0 && jQuery("#checkout-address-page").length < 1 && document.location.href.indexOf("/payment/") < 1) {
          pageVariables.category = "Checkout Success Page";
          return;
        }

        // recognize other pages
        pageVariables.category = "Unknown Page";

        return;
      } catch (err) {
        segmentifyEvents.error(err);
      }
    };

    var triggerPageFunction = function (category) {
      try {
        if (category && pageFunctions.hasOwnProperty(category)) {
          pageFunctions[category]();
        }

        pageFunctions["All Pages"]();
      } catch (err) {
        segmentifyEvents.error(err)
      }
    };

    var init = function () {
      findPageType();
      triggerPageFunction(pageVariables.category);
    };

    var pageFunctions = {
      "All Pages": function () {
        try {

          if (Notification.permission === "granted" && localStorage.getItem("_sgf_permission") === null) {

            window["_SgmntfY_"]._storePersistentData("_sgf_permission", true, 365, true);

            var sgmPermissionCookie = window["_SgmntfY_"]._getPersistentData("__inf_etc__")
            var sgmUserId = window["_SgmntfY_"]._getPersistentData("_sgf_user_id")


            var settings = {
              "url": "https://gimli-eu.segmentify.com/exponea/subscription/push?apiKey=732d8f2b-6c40-4878-851e-f8beace5d405",
              "method": "POST",
              "timeout": 0,
              "headers": {
                "Connection": "keep-alive",
                "User-Agent": _SgmntfY_._variables.ua.agentString,
                "Content-Type": "application/json",
                "Accept": "*/*"
              },
              "data": JSON.stringify({
                "userId": sgmUserId,
                "deviceType": _SgmntfY_._variables.ua.type.toUpperCase(),
                "permissionCookie": sgmPermissionCookie,
                "agent": bowser.name //_SgmntfY_._variables.ua.name 
              })
            };

            window.jQuery.ajax(settings);
          }


          window.ABNumber = Math.floor(Math.random() * 10);

          //homepage A/B
          if (typeof localStorage["sgmGroup"] === "undefined") {
            var _controller = Math.floor(Math.random() * 2);
            if (_controller < 1) {
              localStorage["sgmGroup"] = "A";
            } else if (_controller >= 0) {
              localStorage["sgmGroup"] = "B";
            }
          }
          //

          if (typeof window.AB_Search != undefined && window.AB_Search === "Segmentify") {

            jQuery("input.searchTerm").addClass("Segmentify");
          }
        } catch (err) {
          segmentifyEvents.error(err);
        }

        segmentifyEvents.viewPage(pageVariables.category || "Unknown Page", pageVariables.subCategory, pageVariables.params);
      },
      "Product Page": function () {
        try {
          var segCounter = 0;

          function waitSegData() {
            try {
              if (typeof window.dataLayer != "undefined" && helperFunctions.findPropertyInArray("ecommerce", dataLayer) &&
                helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce &&
                helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail &&
                helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail.products[0] &&
                helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail.products[0].category
              ) {
                var product = helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail.products[0];

                if (product) {
                  var productObj = {};
                  var isMobile = (window["_SgmntfY_"]._variables.ua.type || "").toLowerCase() === "mobile";

                  // Gather information about the product
                  productObj["brand"] = jQuery(".product-details .product-brand").text().trim() || "";
                  productObj["title"] = product["name"] || "";
                  productObj["productId"] = product["id"];
                  productObj["image"] = jQuery(".product-img-inner img:first").attr("src").indexOf("http:") >= 0 ? jQuery(".product-img-inner img:first").attr("src").replace("http", "https") : jQuery(".product-img-inner img:first").attr("src") || "";
                  productObj["price"] = helperFunctions.priceFormatter(jQuery(".product-details .current-price:first").text(), [",", "."]) || "";
                  productObj["oldPrice"] = "";
                  productObj["inStock"] = jQuery("button[name='addProduct']").length > 0 ? true : false;
                  productObj["url"] = jQuery('link[rel="canonical"]').attr("href") || "";
                  productObj["noUpdate"] = isMobile;
                  productObj["category"] = "";
                  productObj["categories"] = [];
                  productObj["params"] = {
                    "discountRate": jQuery(".product-img-discount").text().split(/(\d+)/)[1]
                  }

                  // get old price information if there is a discount
                  if (jQuery(".product-details .was-price:first")) {
                    productObj["oldPrice"] = helperFunctions.priceFormatter(jQuery(".product-details .was-price:first").text(), [",", "."]) || "";
                  }

                  if (productObj["url"].indexOf("edit.elefant.md") >= 0) {
                    productObj["noUpdate"] = true;
                  }

                  if (!isMobile && window.productCategory.indexOf('Erotic') < 0) {
                    productObj["noUpdate"] = ["image"];
                  }

                  var _category = helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail.products[0].category;

                  productObj["category"] = _category.split("/").join(" > ");

                  // Send product view event
                  segmentifyEvents.viewProduct(productObj);
                }
              } else if (segCounter < 10) {
                segCounter++
                setTimeout(waitSegData, 200)
              }
            } catch (err) {
              segmentifyEvents.error(err);
            }
          }
          waitSegData();
        } catch (err) {
          segmentifyEvents.error(err);
        }
        try {
          // handle add to basket event
          window.jQuery(document).ajaxComplete(function (events, xhr, settings) {
            try {
              var product = helperFunctions.findPropertyInArray("ecommerce", dataLayer).ecommerce.detail.products[0] || "";
              if (settings && settings.url && settings.url.indexOf("-AddProduct") >= 0 && xhr.status === 200 && product) {
                var productId = productObj["productId"];
                var quantity = "1";
                var price = productObj["price"];

                segmentifyEvents.basketAdd({
                  "productId": productId,
                  "quantity": quantity,
                  "price": price
                })
              }
            } catch (err) {
              segmentifyEvents.error(err);
            }
          });
        } catch (err) {
          segmentifyEvents.error(err);
        }
      },
      "Basket Page": function () {
        try {
          if (jQuery(".form-horizontal .row .list-item-row ").length == 0) {
            Segmentify('checkout:basket', {
              totalPrice: 0
            })
          } else {
            var basketProducts = [];
            var basketRows = jQuery(".list-body-cart .list-item-row");

            basketRows.each(function () {
              try {
                basketProducts.push({
                  "productId": jQuery(this).find(".list-item > a").attr("href").split("_").slice(-1).toString(),
                  "quantity": jQuery(this).find("input.js-product-qty").val(),
                  "price": helperFunctions.priceFormatter(jQuery(this).find(".unit-price").text().split(" ")[0])
                });
              } catch (err) {
                segmentifyEvents.error(err);
              }
            });

            window.segCartProducts = basketProducts;

            // Put basket event information into a variable
            var basketInfo = {
              "totalPrice": helperFunctions.priceFormatter(jQuery("dd.total-price").text(), [",", "."]),
              "productList": basketProducts
            };

            // Send checkout basket event
            segmentifyEvents.checkoutBasket(basketInfo);
          }
        } catch (err) {
          segmentifyEvents.error(err);
        }
      },
      "Checkout Success Page": function () {
        try {
          var segCounterC = 0;

          function waitPageData() {
            try {
              if (typeof window.dataLayer != "undefined" &&
                helperFunctions.findPropertyInArray("ecommerce", window.dataLayer) &&
                helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce &&
                helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce.purchase &&
                helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce.purchase.products &&
                helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce.purchase.actionField
              ) {
                var products = helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce.purchase.products;
                var transaction = helperFunctions.findPropertyInArray("ecommerce", window.dataLayer).ecommerce.purchase.actionField;

                if (products && products.length && transaction) {
                  var purchaseAmount = transaction.revenue;
                  var purchaseProducts = [];
                  var orderNo = transaction.id;

                  for (var i = 0; i < products.length; i++) {
                    purchaseProducts.push({
                      "productId": products[i]["id"],
                      "quantity": products[i]["quantity"],
                      "price": products[i]["price"]
                    });
                  }

                  // Put purchase event information into a variable
                  var purchaseInfo = {
                    "orderNo": orderNo,
                    "totalPrice": purchaseAmount,
                    "productList": purchaseProducts
                  };

                  // Send checkout purchase event
                  segmentifyEvents.checkoutPurchase(purchaseInfo);
                } else {
                  Segmentify("event:custom", {
                    type: "error_handler",
                    params: {
                      "errorMessage": "Data layer undefined"
                    }
                  });
                }
              } else if (segCounterC < 30) {
                segCounterC++;
                setTimeout(waitPageData, 100)
              }
            } catch (err) {
              segmentifyEvents.error(err)
            }
          }
          waitPageData();
        } catch (err) {
          Segmentify("event:custom", {
            type: "error_handler",
            params: {
              "errorMessage": err.toString()
            }
          })
        }

      }
    };

    return {
      init: init,
      events: segmentifyEvents,
      helpers: helperFunctions
    };
  };

  // Call Wait Function at the bottom of tne script
  waitSegmentifyAndjQuery();
}
/* Wed Apr 14 08:22:43 UTC 2021 */
function initializeMustache(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function a(e){return"function"==typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var o=/\S/;function _(e){return!function(e,t){return s.call(e,t)}(o,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var g=/\s*/,m=/\s+/,l=/\s*=/,d=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function u(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function S(){this.cache={}}u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var r,s,o=this,_=!1;o;){if(e.indexOf(".")>0)for(t=o.view,r=e.split("."),s=0;null!=t&&s<r.length;)s===r.length-1&&(_=i(t,r[s])),t=t[r[s++]];else t=o.view[e],_=i(o.view,e);if(_)break;o=o.parent}n[e]=t}return a(t)&&(t=t.call(this.view)),t},S.prototype.clearCache=function(){this.cache={}},S.prototype.parse=function(t,a){var i=this.cache,s=i[t];return null==s&&(s=i[t]=function(t,a){if(!t)return[];var i,s,o,c=[],p=[],S=[],v=!1,h=!1;function Y(){if(v&&!h)for(;S.length;)delete p[S.pop()];else S=[];v=!1,h=!1}function y(e){if("string"==typeof e&&(e=e.split(m,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(r(e[0])+"\\s*"),s=new RegExp("\\s*"+r(e[1])),o=new RegExp("\\s*"+r("}"+e[1]))}y(a||e.tags);for(var b,E,I,w,C,O,A=new u(t);!A.eos();){if(b=A.pos,I=A.scanUntil(i))for(var R=0,T=I.length;R<T;++R)_(w=I.charAt(R))?S.push(p.length):h=!0,p.push(["text",w,b,b+1]),b+=1,"\n"===w&&Y();if(!A.scan(i))break;if(v=!0,E=A.scan(f)||"name",A.scan(g),"="===E?(I=A.scanUntil(l),A.scan(l),A.scanUntil(s)):"{"===E?(I=A.scanUntil(o),A.scan(d),A.scanUntil(s),E="&"):I=A.scanUntil(s),!A.scan(s))throw new Error("Unclosed tag at "+A.pos);if(C=[E,I,b,A.pos],p.push(C),"#"===E||"^"===E)c.push(C);else if("/"===E){if(!(O=c.pop()))throw new Error('Unopened section "'+I+'" at '+b);if(O[1]!==I)throw new Error('Unclosed section "'+O[1]+'" at '+b)}else"name"===E||"{"===E||"&"===E?h=!0:"="===E&&y(I)}if(O=c.pop())throw new Error('Unclosed section "'+O[1]+'" at '+A.pos);return function(e){for(var t,n=[],a=n,r=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":a.push(t),r.push(t),a=t[4]=[];break;case"/":r.pop()[5]=t[2],a=r.length>0?r[r.length-1][4]:n;break;default:a.push(t)}return n}(function(e){for(var t,n,a=[],r=0,i=e.length;r<i;++r)(t=e[r])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(a.push(t),n=t));return a}(p))}(t,a)),s},S.prototype.render=function(e,t,n){var a=this.parse(e),r=t instanceof p?t:new p(t);return this.renderTokens(a,r,n,e)},S.prototype.renderTokens=function(e,t,n,a){for(var r,i,s,o="",_=0,c=e.length;_<c;++_)s=void 0,"#"===(i=(r=e[_])[0])?s=this.renderSection(r,t,n,a):"^"===i?s=this.renderInverted(r,t,n,a):">"===i?s=this.renderPartial(r,t,n,a):"&"===i?s=this.unescapedValue(r,t):"name"===i?s=this.escapedValue(r,t):"text"===i&&(s=this.rawValue(r)),void 0!==s&&(o+=s);return o},S.prototype.renderSection=function(e,t,r,i){var s=this,o="",_=t.lookup(e[1]);if(_){if(n(_))for(var c=0,g=_.length;c<g;++c)o+=this.renderTokens(e[4],t.push(_[c]),r,i);else if("object"==typeof _||"string"==typeof _||"number"==typeof _)o+=this.renderTokens(e[4],t.push(_),r,i);else if(a(_)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(_=_.call(t.view,i.slice(e[3],e[5]),function(e){return s.render(e,t,r)}))&&(o+=_)}else o+=this.renderTokens(e[4],t,r,i);return o}},S.prototype.renderInverted=function(e,t,a,r){var i=t.lookup(e[1]);if(!i||n(i)&&0===i.length)return this.renderTokens(e[4],t,a,r)},S.prototype.renderPartial=function(e,t,n){if(n){var r=a(n)?n(e[1]):n[e[1]];return null!=r?this.renderTokens(this.parse(r),t,n,r):void 0}},S.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},S.prototype.escapedValue=function(t,n){var a=n.lookup(t[1]);if(null!=a)return e.escape(a)},S.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var v=new S;e.clearCache=function(){return v.clearCache()},e.parse=function(e,t){return v.parse(e,t)},e.render=function(e,t,a){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(r=e)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return v.render(e,t,a)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(!a(i))return s;i(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return c[e]})},e.Scanner=u,e.Context=p,e.Writer=S}!function(e,t,n){e.bowser=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function a(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var r,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),_=/nexus\s*[0-6]\s*/i.test(t),c=!_&&/nexus\s*[0-9]+/i.test(t),g=/CrOS/.test(t),m=/silk/i.test(t),l=/sailfish/i.test(t),d=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),u=/windows phone/i.test(t),p=(/SamsungBrowser/i.test(t),!u&&/windows/i.test(t)),S=!i&&!m&&/macintosh/i.test(t),v=!o&&!l&&!d&&!f&&/linux/i.test(t),h=a(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),Y=n(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t)&&!/tablet pc/i.test(t),b=!y&&/[^-]mobi/i.test(t),E=/xbox/i.test(t);/opera/i.test(t)?r={name:"Opera",opera:e,version:Y||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?r={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||Y}:/SamsungBrowser/i.test(t)?r={name:"Samsung Internet for Android",samsungBrowser:e,version:Y||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?r={name:"Opera Coast",coast:e,version:Y||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?r={name:"Yandex Browser",yandexbrowser:e,version:Y||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?r={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?r={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?r={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?r={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?r={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?r={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:u?(r={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},h?(r.msedge=e,r.version=h):(r.msie=e,r.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:g?r={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?r={name:"Microsoft Edge",msedge:e,version:h}:/vivaldi/i.test(t)?r={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||Y}:l?r={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(r={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=e,r.osname="Firefox OS")):m?r={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?r={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:Y||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(r={name:"WebOS",osname:"WebOS",webos:e,version:Y||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=e)):/bada/i.test(t)?r={name:"Bada",osname:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:d?r={name:"Tizen",osname:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||Y}:/qupzilla/i.test(t)?r={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||Y}:/chromium/i.test(t)?r={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||Y}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?r={name:"Android",version:Y}:/safari|applewebkit/i.test(t)?(r={name:"Safari",safari:e},Y&&(r.version=Y)):i?(r={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},Y&&(r.version=Y)):r=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||Y}:{name:n(/^(.*)\/(.*) /),version:a(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(r.name=r.name||"Blink",r.blink=e):(r.name=r.name||"Webkit",r.webkit=e),!r.version&&Y&&(r.version=Y)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=e,r.version=r.version||n(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||!o&&!r.silk?!r.windowsphone&&i?(r[i]=e,r.ios=e,r.osname="iOS"):S?(r.mac=e,r.osname="macOS"):E?(r.xbox=e,r.osname="Xbox"):p?(r.windows=e,r.osname="Windows"):v&&(r.linux=e,r.osname="Linux"):(r.android=e,r.osname="Android");var I="";r.windows?I=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?I=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?I=(I=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):i?I=(I=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):o?I=n(/android[ \/-](\d+(\.\d+)*)/i):r.webos?I=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?I=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?I=n(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(I=n(/tizen[\/\s](\d+(\.\d+)*)/i)),I&&(r.osversion=I);var w=!r.windows&&I.split(".")[0];return y||c||"ipad"==i||o&&(3==w||w>=4&&!b)||r.silk?r.tablet=e:(b||"iphone"==i||"ipod"==i||o||_||r.blackberry||r.webos||r.bada)&&(r.mobile=e),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=e:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=e:r.x=e,r}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function a(e){return e.split(".").length}function r(e,t){var n,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)a.push(t(e[n]));return a}function i(e){for(var t=Math.max(a(e[0]),a(e[1])),n=r(e,function(e){var n=t-a(e);return r((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function s(e,a,r){var s=n;"string"==typeof a&&(r=a,a=void 0),void 0===a&&(a=!1),r&&(s=t(r));var o=""+s.version;for(var _ in e)if(e.hasOwnProperty(_)&&s[_]){if("string"!=typeof e[_])throw new Error("Browser version in the minVersion map should be a string: "+_+": "+String(e));return i([o,e[_]])<0}return a}return n.test=function(e){for(var t=0;t<e.length;++t){var a=e[t];if("string"==typeof a&&a in n)return!0}return!1},n.isUnsupportedBrowser=s,n.compareVersions=i,n.check=function(e,t,n){return!s(e,t,n)},n._detect=t,n}()}(this),function(){var _SgmntfY_=window._SgmntfY_={LOG_LEVELS:{SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},_variables:{jq:window.SegmentifyjQuery||null,mustache:null,domain:window.SegmentifyDomain||window.location.hostname,ua:{agentString:window.navigator.userAgent,type:null,name:null,version:null,os:null,osversion:null},search:{maxMobileWidth:801,searchMinChar:0,searchDelay:50,input:"",manuelTrigger:"",manuelTriggerEnabledForDesktop:!1,manuelTriggerDesktop:"",cancelText:"Cancel",showAll:"Show All",notFound:"Sorry, there are no results for that search term. ",initialCampaign:null,isExecutable:!1,searchTimer:null,isExecutableForAfter:!1,manuelTriggerClicked:!1},journey:{},userStorageKey:"_sgf_user_id",sessionStorageKey:"_sgf_session_id",pushPermissionKey:"_sgf_push_permission_asked",testMode:"_sgf_test_mode",tracking:"_sgf_tracking",storage:{delayedActions:{key:"_sgf_delayed_actions",local:!0},delayedCampaigns:{key:"_sgf_delayed_campaigns",local:!0},retryQueue:{key:"_sgf_rq",local:!0},extensionStatus:{key:"segmentifyExtension",local:!0},qaExtensionStatus:{key:"_sgf_qa_ext",local:!0},searchBetaExtensionStatus:{key:"_sgf_search_beta_ext",local:!0},clickedBanners:{key:"_sgf_clicked_banners",local:!1},nextPageQueue:{key:"_sgf_npq",local:!0},user:{key:"_sgf_user_id",local:!1},session:{key:"_sgf_session_id",local:!1},qaMode:{key:"_sgf_qa_mode",local:!0},searchBetaMode:{key:"_sgf_search_beta_mode",local:!0},searchNoCache:{key:"_sgf_search_no_cache",local:!0}},logLevel:"ERROR",segmentifyObj:null,recommendedProducts:[],recommendedPromotions:[],waitingKeys:!1,keysTryCount:0,apiKey:null,skipProductDetail:{device:[]},offerRecommendedProducts:!1,offerRecommendedPromotions:!1,runTimer:null,initTimer:null,initTryCount:0,initTryLimit:50,isUnload:!1,cssPreload:!1,constants:{frequency:100,redirectDelay:1e3,retryLimit:3,eventTimeout:10,clickedBannersLimit:20,recommendationSelectorFindLimit:50},requiredParams:{PAGE_VIEW:[],PRODUCT_VIEW:["productId"],BASKET_OPERATIONS:["productId","basketId","step"],CHECKOUT:["totalPrice","basketId","step"],USER_OPERATIONS:["step"],FORM:["formName","fields"],CUSTOM_EVENT:["type"],INTERACTION:["type"],BANNER_OPERATIONS:["type","title","group","order"],BANNER_GROUP_VIEW:["group"],INTERNAL_BANNER_GROUP:["group"],USER_CHANGE:["oldUserId"],PROMOTION:["type","code"],SEARCH:[],FILTER:["source"],COUPON:["type"],JOURNEY:["type"]},optionalParams:{PAGE_VIEW:["category","subCategory"],PRODUCT_VIEW:["title","url","mUrl","image","imageXS","imageS","imageM","imageL","imageXL","additionalImages","mainCategory","category","categories","price","oldPrice","specialPrice","lastUpdateTime","inStock","stockCount","stockRatio","stockStatus","brand","gender","labels","sizes","allSizes","colors","publishTime","source","noUpdate","activeBanners","groupId"],BASKET_OPERATIONS:["price","quantity","size","activeBanners"],CHECKOUT:["productList","orderNo","paymentType","activeBanners","cartUrl","totalDiscount","discounts","shipment","tax","coupon"],USER_OPERATIONS:["username","fullName","phone","gender","birthDate","segments","memberSince","service","isRegistered","isLogin","location","emailNtf","mailTest","pushTest","custom"],FORM:[],CUSTOM_EVENT:[],INTERACTION:["interactionId","instanceId"],BANNER_OPERATIONS:["productId","category","brand","label"],BANNER_GROUP_VIEW:[],INTERNAL_BANNER_GROUP:["banners"],USER_CHANGE:[],PROMOTION:["title","url","mUrl","image","mImage","startDate","endDate","categories","brands","labels","productIds","publishTime"],SEARCH:["query"],FILTER:["productId","categories","brands","sizes","prices"],COUPON:[],JOURNEY:["step","answer","instanceId"]},segmentifyApiUrl:"//gandalf.segmentify.com/",segmentifyQaApiUrl:"//gandalf-qa.segmentify.com",segmentifyCDNUrl:"//cdn.segmentify.com/",jQueryUrl:"//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",dataLayer:"sgfLayer",consumeDataLayer:!0,dataLayerConfig:{},categoryHierarchy:!1,disableNextPage:!1,language:"EN",currency:"",region:"",pushInfo:{dataCenter:"",qaDataCenter:"https://gimli-qa.segmentify.com/",promptInteraction:""},ga:{groupCookie:"__SegmentifyGroup__",group:void 0,tracker:"window.ga",trackerName:void 0,activated:!1,enabled:!1,activateTryCount:100,activateTriedCount:0,activeGroup:void 0,activePage:void 0,groups:{control:"SGM-CG",groupA:"SGM-GA",groupB:"SGM-GB",unknown:"SGM-UN"},dimensions:{sgmGroup:void 0,sgmUser:void 0,sgmSession:void 0,sgmPage:void 0,sgmWidget:void 0,sgmProduct:void 0}}},_loadJavascript:function(e,t,n){var a=document.createElement("script");return a.type="text/javascript",a.async=t,n&&"function"==typeof n&&(void 0!==a.onreadystatechange?a.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(n(),a.onreadystatechange=null)}:a.onload=n),a.src=e,document.getElementsByTagName("head")[0].appendChild(a),a},_loadCSS:function(e,t){var n=document.createElement("link");return n.type="text/css",_SgmntfY_._variables.cssPreload?(n.rel="preload",n.as="style"):n.rel="stylesheet",n.media="screen",t&&"function"==typeof t&&(void 0!==n.onreadystatechange?n.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(t(),n.onreadystatechange=null)}:n.onload=t),n.href=e,document.getElementsByTagName("head")[0].appendChild(n),n},_sgfPopupCloseHandler:function(e,t){(!1===e||_SgmntfY_._jbOverFlowOperations._journeyFinished(t))&&(_SgmntfY_._jbOverFlowOperations._enableBodyOverFlowForJBWrapper(),_SgmntfY_._jbTriggerButtonReEnable(),window.setTimeout(function(){var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&e.parentNode.removeChild(e)},500))},_actions:{_notificationWindow:function(params){var config={title:params.notificationTitle,vertical:"middle",horizontal:"center"},title=params.notificationTitle;switch(params.windowPosition){case"top":config.vertical="top";break;case"bottom":config.vertical="bottom";break;case"left":config.horizontal="left";break;case"right":config.horizontal="right";break;case"top-left":config.vertical="top",config.horizontal="left";break;case"top-right":config.vertical="top",config.horizontal="right";break;case"bottom-left":config.vertical="bottom",config.horizontal="left";break;case"bottom-right":config.vertical="bottom",config.horizontal="right"}var outerHtml=_SgmntfY_._getJq()('<div class="seg-popup seg-[[vertical]]-[[horizontal]] segFadeInUp fancybox-segmentify"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>'),notificationBody=_SgmntfY_._getJq()('<div class="fancybox-body" />').appendTo(outerHtml.find(".fancybox-inner"));params.html instanceof _SgmntfY_._getJq()?notificationBody.append(params.html):notificationBody.html(params.html);for(var button_overlay=_SgmntfY_._getJq()("<div />").appendTo(notificationBody),buttons=params.buttons||[],i=0;i<buttons.length;i++)_SgmntfY_._getJq()('<button data-newWindow="'+buttons[i].newWindow+'" data-target="'+buttons[i].buttonUrl+'" class="fancybox-button '+buttons[i].buttonColor+'">'+buttons[i].buttonTitle+"</button>").appendTo(button_overlay);"seamless"===params.windowStyle&&(title&&_SgmntfY_._getJq()('<div class="overlay-area-title" ><span>'+title+"</span></div>").appendTo(notificationBody),button_overlay.addClass("overlay-area-buttons").addClass("right"),title=null),"false"===params.isModal&&_SgmntfY_._getJq()('<span class="seg-popup-close"></span>').appendTo(outerHtml);var renderedHtml=_SgmntfY_._getMustache().render(outerHtml.prop("outerHTML"),config);_SgmntfY_._getJq()("body").prepend(renderedHtml),"true"===params.overlay&&(_SgmntfY_._getJq()('<div class="seg-popup-overlay"></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._getJq()(".seg-popup-overlay").show()),"false"===params.isModal&&_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:params.instanceId,interactionId:params.instanceId})}),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body"));try{params.javascriptCode&&eval(params.javascriptCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing javascript code: "+e)}if(_SgmntfY_._getJq()(".seg-popup").find("form")){var $inner=_SgmntfY_._getJq()(".seg-popup .fancybox-body"),$form=$inner.find("form").eq(0);$form.bind("submit",function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","Popup Form button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:params.formName,instanceId:params.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:params.formName,fields:$form.sgmSerializeForm()}),$inner.html(params.successHtml),setTimeout(function(){$inner.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),$inner.parents(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)})}var redirectFn=function(e){var t=function(e,t){window.open(e.data("target"),t),e.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)};"true"===e.data("newwindow")||!0===e.data("newwindow")?t(e,"_blank"):setTimeout(function(){t(e,"_self")},_SgmntfY_._variables.constants.redirectDelay)};_SgmntfY_._getJq()(".seg-popup .fancybox-button").click(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Window button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:_SgmntfY_._getJq()(this).text(),instanceId:params.instanceId}),redirectFn(_SgmntfY_._getJq()(this))}),_SgmntfY_._getJq()(".seg-popup a img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:params.instanceId,interactionId:params.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:params.instanceId,interactionId:params.instanceId})},notificationBanner:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.buttons=t,e.html=_SgmntfY_._getJq()('<div><a href="'+e.redirectUrl+'"><img id="sgm_img" src="'+e.imageUrl+'"></a></div>'),_SgmntfY_._actions._notificationWindow(e)},notificationMessage:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.html=e.notificationText,e.buttons=t,_SgmntfY_._actions._notificationWindow(e)},visitorForm:function(e){switch(e.actionType){case"INPAGE_WIDGET":(function e(){var t=this.params,n=this.selectorCount,a=t.selector;if(a&&_SgmntfY_._getJq()(a).length)try{a.addClass("sgm-recommendation sgm-clearcss").html(t.formHtml);var r=a.find("form").eq(0);r.submit(function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","In-page Form button click for actionId: "+t.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:t.formName,instanceId:t.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:t.formName,fields:r.sgmSerializeForm()}),setTimeout(function(){a.html(t.successHtml)},1e3)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in filling target element["+t.selector+"] with visitor form: "+e)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),n<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var i=e.bind(this);setTimeout(i,100)}}).bind({params:e,selectorCount:1})();break;case"POPUP_WINDOW":default:e.html=e.formHtml,_SgmntfY_._actions._notificationWindow(e)}},recommendProducts:function(params,request){var previousMetadata={productId:request.originalParams.productId,productUrl:request.originalParams.productUrl,instanceId:params.instanceId};function dynamicItemKey(e){var t=e.recommendationSource;return void 0!==e.timeFrame&&_SgmntfY_._isNotEmpty(e.timeFrame)&&(t+="|"+e.timeFrame,void 0!==e.score&&_SgmntfY_._isNotEmpty(e.score)&&(t+="|"+e.score)),t}function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(dynamicItemKey(e[n])===t)return e[n].itemCount;return null}function checkProductInList(e,t){for(var n=0;n<e.length;n++)if(e[n].productId==t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:notificationTitle,products:productList,index:function(){return++renderIdx},discount:function(){try{var e=this.price,t=this.oldPrice;if(!e||!t||e==t)return null;var n=100-100*e/t;return n>0&&Math.round(n)}catch(e){return null}},commaFormatPrice:function(){return this.toFixed(2).toString().replace(/\./g,",")},dotFormatPrice:function(){return this.toFixed(2).toString()}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}var productList=[],recommendedProducts=params.recommendedProducts||{},dynamicItems=JSON.parse(params.dynamicItems)||[],recoVersion=params.version||"v1";if("v1"===recoVersion)if("SHUFFLE"===params.ordering){function allNull(e){for(var t in e)if(e.hasOwnProperty(t)&&(void 0!==e[t]||null!==e[t]))return!1;return!0}function arrayRandom(){return parseInt(100*Math.random())}function randomInt(e,t){return Math.floor(Math.random()*(t-e))+e}var itemCounts=[],dynamicLengths=[];for(var idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){itemCounts.push(parseInt(dynamicItems[idx].itemCount||0));var source=dynamicItemKey(dynamicItems[idx]);recommendedProducts.hasOwnProperty(source)?dynamicLengths.push(recommendedProducts[source].length):dynamicLengths.push(0)}var firstLevel=[],firstLevelTotal=itemCounts.reduce(function(e,t){return e+t},0);for(idx in itemCounts)if(itemCounts.hasOwnProperty(idx)){var _idx=parseInt(idx);if(_idx===itemCounts.length-1)firstLevel.push(100);else{var pct=parseInt(itemCounts[idx]/firstLevelTotal*100);0===_idx?firstLevel.push(pct):firstLevel.push(firstLevel[firstLevel.length-1]+pct)}}var secondLevel=[];for(var dl in dynamicLengths)if(dynamicLengths.hasOwnProperty(dl)){for(var len=dynamicLengths[dl],sumOfSquares=len*(len+1)*(2*len+1)/6,tmpArr=[],l=len;l>0;--l)1===l?tmpArr.push(100):(pct=parseInt(Math.pow(l,2)/sumOfSquares*100),l===len?tmpArr.push(pct):tmpArr.push(tmpArr[tmpArr.length-1]+pct));secondLevel.push(tmpArr)}for(var dynamicProducts=[],iteration=0;!(++iteration>1e4||dynamicProducts.length>=firstLevelTotal);){var allNullCheck=!0;for(idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){source=dynamicItemKey(dynamicItems[idx]);var tmpCheck=!0;if(recommendedProducts.hasOwnProperty(source)&&(tmpCheck=allNull(recommendedProducts[source])),!tmpCheck){allNullCheck=!1;break}}if(allNullCheck)break;var rand=arrayRandom(),firstLevelIndex=-1;for(var fl in firstLevel)if(firstLevel.hasOwnProperty(fl)&&rand<firstLevel[fl]){firstLevelIndex=parseInt(fl);break}if(-1!==firstLevelIndex&&dynamicItems.hasOwnProperty(firstLevelIndex.toString())){source=dynamicItemKey(dynamicItems[firstLevelIndex]),rand=arrayRandom();var secondLevelIndex=-1;for(var sl in secondLevel[firstLevelIndex])if(secondLevel[firstLevelIndex].hasOwnProperty(sl)&&rand<secondLevel[firstLevelIndex][sl]){secondLevelIndex=parseInt(sl);break}if(-1!==secondLevelIndex&&recommendedProducts[source].hasOwnProperty(secondLevelIndex.toString())){var candidate=recommendedProducts[source].splice(secondLevelIndex,1)[0];if(null!=candidate){recommendedProducts[source].splice(secondLevelIndex,0,null);var eliminationFuncRetVal=!1;if(params.eliminationFunction){var func=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof func)try{eliminationFuncRetVal=func.call(null,candidate)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFuncRetVal){candidate.name=_SgmntfY_._decodeHtml(candidate.name);var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[firstLevelIndex].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[firstLevelIndex].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,candidate.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(candidate.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId));break;case"NO_ELIMINATION":default:productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId)}}}}}}for(var i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.splice(randomInt(0,productList.length),0,elm)}}else{for(var missingCount=0,i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var ri=0;ri<dynamicItems.length;++ri){var curRecommendationSource=dynamicItemKey(dynamicItems[ri]),curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedProducts.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[curRecommendationSource].length;++i){var elm=recommendedProducts[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFnRetVal){var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[ri].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[ri].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}}else if("v3"===recoVersion&&recommendedProducts.length){for(var staticProducts=recommendedProducts[0]||[],i=0;i<staticProducts.length;++i){var elm=staticProducts[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var missingCount=0,ri=1;ri<recommendedProducts.length;++ri){var dynamicItem=dynamicItems[ri-1],curCatItemCount=parseInt(dynamicItem.itemCount);if(isNaN(curCatItemCount)&&(curCatItemCount=0),curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[ri].length;++i){var elm=recommendedProducts[ri][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItem.recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItem.recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle;if(0!==productList.length){"INPAGE_WIDGET"!==params.actionType&&"POPUP_RECO"!==params.actionType&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId));var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(notificationTitle,productList,previousMetadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context();break;case"JAVASCRIPT_FUNCTION":var fx=_SgmntfY_._getObjectByString(window,params.jsFunction);if("function"==typeof fx)try{fx.call(null,notificationTitle,productList,previousMetadata,wvCB)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation js function: "+e)}else _SgmntfY_.LOG_MESSAGE("WARN","Product Recommendation javascript function("+params.jsFunction+") does not exist");break;case"POPUP_RECO":var config={title:params.notificationTitle&&""!==params.notificationTitle?params.notificationTitle:notificationTitle||"",vertical:params.verticalPosition,horizontal:params.horizontalPosition,button:_SgmntfY_._jbGetButtonText("DELIVERY")},isJourney=_SgmntfY_._jbOverFlowOperations._journeyFinished(request);if(!1===isJourney&&productList.length<3)return;config.products=productList;try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetImpression(params.instanceId)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var _products=[],_productId="";request.originalParams&&request.originalParams.params&&(_productId=request.originalParams.params.productId||"");for(var i=0;i<config.products.length&&(!1!==isJourney||3!==_products.length);++i){var _product=config.products[i];_product.productId!==_productId&&_products.push(_product)}if(!1===isJourney&&3!==_products.length)return;config.products=_products;var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._jbDeliveryOnBindEventHandler();try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===params.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!0,request),e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:params.interactionId,instanceId:params.instanceId}),_SgmntfY_.GA.sendWidgetView(params.instanceId)}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback(notificationTitle,[],previousMetadata,null)},recommendPromotion:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame+"|"+e[n].score===t)return e[n].itemCount;return null}function checkPromotionInList(e,t){for(var n=0;n<e.length;n++)if(e[n].code===t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:params.notificationTitle,promotionList:promotionList,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.addClass("seg-promotion-wrapper").html(renderedHtml),targetElement.attr("data-sgf-scenario-id",params.instanceId),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-promotion-wrapper"});$div.attr("data-sgf-scenario-id",params.instanceId),"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with promotion recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var promotionList=[],recommendedPromotions=params.recommendedPromotions||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkPromotionInList(promotionList,elm.code)||promotionList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame+"|"+dynamicItems[ri].score,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedPromotions.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedPromotions[curRecommendationSource].length;++i){var elm=recommendedPromotions[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation elimination js function: "+e)}}if(!eliminationFnRetVal)switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkPromotionInList(promotionList,elm.code)||_SgmntfY_._containsRecommendedPromotion(elm.code)&&!_SgmntfY_._variables.offerRecommendedPromotions||(promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount);break;case"NO_ELIMINATION":default:promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount}}}}if(0!==promotionList.length){"SHUFFLE"===params.ordering&&(promotionList=_SgmntfY_._shuffle(promotionList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(promotionList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context()}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback([],metadata,null)},recommendKeyword:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame==t)return e[n].itemCount;return null}function checkKeywordInList(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1}function checkSelectorAndRender(){var params=this.params,keywordList=this.keywordList,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){for(var keywords=[],k=0;k<keywordList.length;++k)keywords.push({name:keywordList[k],url:""});var recoTitle=params.notificationTitle,renderIdx=0,reConf={title:recoTitle,keywords:keywords,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),targetElement.attr("data-sgf-scenario-id",params.instanceId),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});$div.attr("data-sgf-scenario-id",params.instanceId),"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}_SgmntfY_._bindRecommendationTrackEvents("SELF"===params.insertType?targetElement:$div,params.recommendationSettings,params.instanceId,0),_SgmntfY_._getJq()(".seg-label a").on("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:params.actionId,instanceId:params.instanceId})})}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var keywordList=[],recommendedKeywords=params.recommendedKeywords||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkKeywordInList(keywordList,elm)||keywordList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedKeywords.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedKeywords[curRecommendationSource].length;++i){var elm=recommendedKeywords[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;keywordList.push(elm),++index,--missingCount}}}if(0!==keywordList.length){"SHUFFLE"===params.ordering&&(keywordList=_SgmntfY_._shuffle(keywordList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(keywordList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,keywordList:keywordList,selectorCount:1});binded_context()}}else request.recommendationCallback&&request.recommendationCallback([],metadata,null)},webNotification:function(e){},redirectUrl:function(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Redirecting action to url: "+e.redirectUrl),window.location=e.redirectUrl},jsFunctionCall:function(e){e.actionType="JAVASCRIPT_FUNCTION",_SgmntfY_._actions.jsAction(e)},jsAction:function(params){var actionType=params.actionType;switch(actionType){case"JAVASCRIPT_EVENT":var event=params.event,parameters=[];try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Event Trigger) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),_SgmntfY_._getJq()(document).trigger(event,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Event Trigger) - Triggered Event: "+event);break;case"JAVASCRIPT_CODE":try{eval(params.javascriptCode),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Execute Code) successfully executed")}catch(e){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("WARN","Error in JS Action (Execute Code): "+e)}break;case"JAVASCRIPT_FUNCTION":default:var fx=window[params.function],parameters=[];if("function"==typeof fx){try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),fx.apply(null,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Function Call) successfully run for function: "+params.function)}else _SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) failed, non existing function: "+params.function)}},jsCountdownTimer:function(e){var t=e.timeout;_SgmntfY_.LOG_MESSAGE("DEBUG","Starting countdown timer with "+1e3*(t||0)+" second(s)"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Countdown timer finished after "+1e3*(t||0)+" second(s)"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"timeout",interactionId:e.actionId,instanceId:e.instanceId})},1e3*(t||0))},sendBannerDetails:function(e,t){var n=t.originalParams;n.group=e.group;var a=[],r=_SgmntfY_._functions.bannerGroupDetail(n);r&&a.push(r),_SgmntfY_._sendRequestToServer(a)},showPopup:function(params,request){var config={instanceId:params.instanceId,title:params.notificationTitle,vertical:params.verticalPosition,horizontal:params.horizontalPosition};try{if(params.preJsCode&&""!=params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml);var styleDataId=_SgmntfY_._variables.journey.instanceId+"_trigger";params.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body")),"true"===params.overlay&&(_SgmntfY_._getJq()('<div class="seg-popup-overlay"></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._getJq()(".seg-popup-overlay").show()),document.getElementById("sgm-journey-trigger-"+config.instanceId).addEventListener("click",_SgmntfY_._jbTriggerClickHandler.bind(this,config.instanceId));try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger post js code: "+e)}},buildJourney:function(e,t){var n;if(e.discovery&&(n=JSON.parse(e.discovery)||[]),n.length>0&&n[0].type){_SgmntfY_._jbOnInitJourneyFlowExecution(e.instanceId,n);var a={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:start",a);var r={steps:n,tree:e.tree};_SgmntfY_._jbOnStepViewHandler(r)}},giveCoupon:function(params,request){if(params&&params.coupon){var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle,config={coupon:params.coupon,button:_SgmntfY_._jbGetButtonText("DELIVERY"),couponTitle:notificationTitle,instanceId:params.instanceId};try{if(params.preJsCode&&""!==params.preJsCode){if(eval(params.preJsCode),preRenderConf)var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}var domparser=new DOMParser,hasPopupRecoTemplate=!1;try{if(0===_SgmntfY_._getJq()("#sgm-journey-coupon-template").length){var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml)}else hasPopupRecoTemplate=!0;var couponWrapperTemplate=domparser.parseFromString(params.recommendationTemplate,"text/html").getElementById("sgm-journey-coupon-template"),renderedHtml=_SgmntfY_._getMustache().render(couponWrapperTemplate.innerHTML,config);_SgmntfY_._getJq()("#sgm-journey-coupon-template").html(renderedHtml),_SgmntfY_._getJq()("#sgm-journey-coupon-wrapper").removeClass("sgm-journey-none");var copyButton=document.querySelector(".sgm-journey-discovery-action.sgm-journey-discovery-action-copy");copyButton&&copyButton.classList.remove("sgm-journey-none"),_SgmntfY_._jbDeliveryOnBindEventHandler(hasPopupRecoTemplate),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:params.actionId,instanceId:_SgmntfY_._variables.journey.instanceId});var styleDataId=_SgmntfY_._variables.journey.instanceId+"_delivery";params.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(params.cssCode).prependTo(_SgmntfY_._getJq()(".sgm-journey-delivery.seg-popup"))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in rendering jb coupon: "+e)}try{params.postJsCode&&""!==params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger post js code: "+e)}}}},_jbOverFlowOperations:{_disableBodyOverFlowForJBWrapper:function(){_SgmntfY_._evalSearchBodyScrollLockPreJs();var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&bodyScrollLock.disableBodyScroll(e)},_enableBodyOverFlowForJBWrapper:function(){var e=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);e&&window.setTimeout(function(){bodyScrollLock.enableBodyScroll(e)},100)},_journeyFinished:function(e){return e&&e.originalParams&&("SUCCESS"===e.originalParams.type||"sfy-jb-finish"===e.originalParams.type)}},_jbTriggerClickHandler:function(e){_SgmntfY_._variables.segmentifyObj("journey:init",{instanceId:e})},_jbOnInitJourneyFlowExecution:function(e,t){_SgmntfY_._jbSetInitialVariables(e,t),_SgmntfY_._getJq()(".seg-popup-overlay").remove();var n=_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.journey.maxMobileWidth?"sgm-journey-mobile":"sgm-journey-desktop";document.getElementById("sgm-journey-main-wrapper")||_SgmntfY_._getJq()('<div id="sgm-journey-main-wrapper" class="'+n+'" ></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._jbOverFlowOperations._disableBodyOverFlowForJBWrapper();var a=document.querySelectorAll(".sgm-journey-trigger");a&&a.length>0&&a.forEach(function(e){e.classList.add("sgm-journey-none")})},_jbOnDestroyJourneyFlowExecution:function(e){var t={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:finish",t);try{var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector);!1===e?(_SgmntfY_._jbOverFlowOperations._enableBodyOverFlowForJBWrapper(),_SgmntfY_._jbTriggerButtonReEnable(),n&&n.parentNode.removeChild(n)):n&&n.classList.add("sgm-journey-none")}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in destroying jb flow: "+e)}},_jbTriggerButtonReEnable:function(){var e=document.querySelectorAll(".sgm-journey-trigger");e&&e.length>0&&e.forEach(function(e){e.classList.remove("sgm-journey-none")})},_jbSetInitialVariables:function(e,t){_SgmntfY_._variables.journey={answer:{},closed:!1,instanceId:e,currentStep:null,nextStep:t[0].type,allSteps:t.map(function(e){return e.type}),maxMobileWidth:801,priceRange:{min:void 0,max:void 0},buttonTextMap:_SgmntfY_._variables.journey.buttonTextMap||{EN:{copy:"Copy",next:"Next",close:"Close",skip:"Skip",finish:"Finish",start:"Let's Start",customize:"Customize",skipAndFinish:"Skip & Finish"},TR:{copy:"Kopyala",next:"Sonraki",close:"Kapat",skip:"Atla",finish:"Bitir",start:"Hadi Balayalm",customize:"zelletir",skipAndFinish:"Atla ve Bitir"}},wrapperSelector:"#sgm-journey-main-wrapper"}},_jbTransformStepItems:function(e,t){return t},_jbGetStepItems:function(e,t,n){try{var a=_SgmntfY_._variables.journey.answer;if("MAIN_CATEGORY"===e)return _SgmntfY_._jbTransformStepItems(e,Object.keys(n));if("CATEGORY"===e)return _SgmntfY_._jbTransformStepItems(e,Object.keys(n[a.mainCategory]));if("BRAND"===e)return _SgmntfY_._jbTransformStepItems(e,Object.keys(n[a.mainCategory][a.category]));if("SIZE"===e||"COLOR"===e||"PRICE_RANGE"===e||"CUSTOM_PRICE_RANGE"===e){var r={SIZE:"s",COLOR:"c",PRICE_RANGE:"p",CUSTOM_PRICE_RANGE:"p"},i=[];if(_SgmntfY_._variables.journey.allSteps.indexOf("BRAND")>-1){var s=Object.keys(n[a.mainCategory][a.category]);a.brand&&a.brand.length>0&&(s=a.brand),s.forEach(function(t){var s=n[a.mainCategory][a.category][t];i.push.apply(i,s[r[e]]||[])})}else{var o=n[a.mainCategory][a.category];i.push.apply(i,o[r[e]]||[])}if("PRICE_RANGE"===e||"CUSTOM_PRICE_RANGE"===e){var _=i.map(m.bind(null,!1)).sort(l),c=i.map(m.bind(null,!0)).sort(l);return _&&_.length>0&&c&&c.length>0?"CUSTOM_PRICE_RANGE"===e?[_[0],c[c.length-1]]:_SgmntfY_._jbGetPriceRangeData(_[0],c[c.length-1]):[]}var g=0;return t.forEach(function(e){e&&e.itemCount&&(g+=e.itemCount)}),_SgmntfY_._getDistinctArray(i.sort(function(e,t){return Object.entries(t)[0][1]-Object.entries(e)[0][1]}).map(function(e){var t=Object.entries(e);return t&&t[0]&&t[0][0]?t[0][0]:void 0})).slice(0,g)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error occurred while preparing journey items")}return[];function m(e,t){var n=!0===e?1:0;if(t&&t.split("-")&&t.split("-")[n]){var a=t.split("-")[n].trim();return""===a?0:parseFloat(a)}}function l(e,t){return e-t}},_jbGetPriceRangeData:function(e,t){if(0===e&&0===t)return[];var n=_(e,!1),a=_(t,!0);if(n==a)return e===t?[e.toString()]:[e+" - "+t];var r=(a-n)/6,i=n+r,s=i+2*r,o=s+2*r;return["0 - "+c(i),c(i)+" - "+c(s),c(s)+" - "+c(o),c(o)+"+"];function _(e,t){var n;if(e>1e5){var a=e%1e3;!0===t&&(e+=1e3),n=e-a}else if(e>1e4){a=e%500;!0===t&&(e+=500),n=e-a}else if(e>1e3){a=e%100;!0===t&&(e+=100),n=e-a}else if(e>100){a=e%50;!0===t&&(e+=50),n=e-a}else if(e>50){a=e%25;!0===t&&(e+=25),n=e-a}else n=e>25?50:12;return n}function c(e){var t=e%5;return t>=2.5&&(e+=5),parseInt(e-t)}},_jbGetButtonText:function(e,t){var n={};if(_SgmntfY_._variables.journey&&_SgmntfY_._variables.journey.buttonTextMap){var a=_SgmntfY_._variables.journey.buttonTextMap[_SgmntfY_._variables.language]?_SgmntfY_._variables.language:"EN";t&&t[_SgmntfY_._variables.language]?n.next=t[_SgmntfY_._variables.language]:n.next="WELCOME"===e?_SgmntfY_._variables.journey.buttonTextMap[a].start:_SgmntfY_._variables.journey.buttonTextMap[a].next,n.skip=_SgmntfY_._variables.journey.buttonTextMap[a].skip,n.skipAndFinish=_SgmntfY_._variables.journey.buttonTextMap[a].skipAndFinish,n.finish=_SgmntfY_._variables.journey.buttonTextMap[a].finish,n.copy=_SgmntfY_._variables.journey.buttonTextMap[a].copy,n.close=_SgmntfY_._variables.journey.buttonTextMap[a].close,n.customize=_SgmntfY_._variables.journey.buttonTextMap[a].customize}return n},_jbOnStepViewHandler:function(jbDiscoveryData){var currentStep=_SgmntfY_._jbGetCurrentStepData(jbDiscoveryData,!0);if(currentStep){shiftStep(currentStep);var config={title:currentStep.titleMap[_SgmntfY_._variables.language],step:currentStep.type.toLowerCase(),button:_SgmntfY_._jbGetButtonText(currentStep.type,currentStep.buttonTextMap),items:_SgmntfY_._jbGetStepItems(currentStep.type,currentStep.items,jbDiscoveryData.tree),currencyCode:_SgmntfY_._variables.currency},params={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId};_SgmntfY_._variables.segmentifyObj("journey:view",params);try{if(currentStep.preJsCode&&""!=currentStep.preJsCode){if(eval(currentStep.preJsCode),preRenderConf)var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing jb trigger pre js code: "+e)}if("WELCOME"!==_SgmntfY_._variables.journey.currentStep&&0===config.items.length)_SgmntfY_._jbOnStepViewHandler(jbDiscoveryData);else{var renderedHtml=_SgmntfY_._getMustache().render(currentStep.recommendationTemplate,config);_SgmntfY_._getJq()("#sgm-journey-main-wrapper").html(renderedHtml),_SgmntfY_._jbOnBindEventHandler(jbDiscoveryData,config.items);var styleDataId=_SgmntfY_._variables.journey.instanceId+"_"+currentStep.type;currentStep.cssCode&&_SgmntfY_._getJq()("<style data-id="+styleDataId+"/>").html(currentStep.cssCode).prependTo(_SgmntfY_._getJq()(_SgmntfY_._variables.journey.wrapperSelector)),_SgmntfY_._variables.journey.nextStep?"WELCOME"===_SgmntfY_._variables.journey.currentStep?_SgmntfY_._jbActionButtonHandler("next",currentStep,!0):_SgmntfY_._jbActionButtonHandler("skip",currentStep,!0):_SgmntfY_._jbActionButtonHandler("skipAndFinish",currentStep,!0);try{currentStep.postJsCode&&eval(currentStep.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}}}else _SgmntfY_._variables.segmentifyObj("journey:success",{instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)});function shiftStep(e){_SgmntfY_._variables.journey.currentStep=e.type;for(var t=0;t<jbDiscoveryData.steps.length;t++){if(jbDiscoveryData.steps[t]&&jbDiscoveryData.steps[t].type===e.type&&jbDiscoveryData.steps[t+1]){_SgmntfY_._variables.journey.nextStep=jbDiscoveryData.steps[t+1].type;break}t===jbDiscoveryData.steps.length-1&&(_SgmntfY_._variables.journey.nextStep=void 0)}}},_jbGetCurrentStepData:function(e,t){var n=e.steps.filter(function(e){return e.type===(!0===t?_SgmntfY_._variables.journey.nextStep:_SgmntfY_._variables.journey.currentStep)});if(n)return n[0]},_jbOnBindEventHandler:function(e,t){var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-topbar span.sgm-journey-close");n&&n.addEventListener("click",_SgmntfY_._jbExitHandler);var a=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-action");a&&a.addEventListener("click",_SgmntfY_._jbOnStepChangeHandler.bind(this,e));var r=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content .sgm-journey-price-range-customize-button");r&&r.addEventListener("click",_SgmntfY_._jbOnPriceRangeCustomizeHandler.bind(this,t,e));var i=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content .sgm-journey-content-item");i&&i.length>0&&i.forEach(function(t){t.addEventListener("click",_SgmntfY_._jbOnDataSelectHandler.bind(this,e),!1)})},_jbDeliveryOnBindEventHandler:function(e){var t=document.querySelectorAll(".sgm-journey-delivery .sgm-journey-discovery-action");t&&t.length>0&&(t.forEach(function(e){"copy"===e.getAttribute("data-type")?e.addEventListener("click",_SgmntfY_._textCopyToClipBoard.bind(this,"sgm-journey-delivery-coupon")):"close"===e.getAttribute("data-type")&&e.addEventListener("click",_SgmntfY_._jbOnCloseDelivery)}),!1===e&&_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!1),e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}))},_jbOnCloseDelivery:function(){var e=document.querySelector(".sgm-journey-delivery.seg-popup");e&&(e.classList.remove("segFadeInUp"),e.classList.add("segFadeOutDown"),window.setTimeout(function(){_SgmntfY_._sgfPopupCloseHandler(!1),e.parentNode.removeChild(e)},1e3))},_jbOnPriceRangeCustomizeHandler:function(e,t){var n=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-price-range-select"),a=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-price-range-custom");if(n&&a){n.classList.add("sgm-journey-none"),a.classList.remove("sgm-journey-none");var r=_SgmntfY_._jbGetCurrentStepData(t,!1);_SgmntfY_._jbActionButtonHandler("finish",r,!0);var i=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+".sgm-journey-content-selected");i&&i.length>0&&i.forEach(function(e){e.classList.remove("sgm-journey-content-selected")});var s,o,_=_SgmntfY_._jbGetStepItems("CUSTOM_PRICE_RANGE",null,t.tree);_&&2===_.length?(s=_[0],o=_[1]):(s=parseInt(e&&e.length>0?e[0].replace("-","").trim():0),o=parseInt(e&&e.length>0?e[e.length-1].replace("-","").trim():0)),s-=s%10,o=o-o%10+10;var c=_SgmntfY_._variables.journey.priceRange.min||(s>=2?s-2:s),g=_SgmntfY_._variables.journey.priceRange.max||o+(o>10?20:5);function m(e,t){"input"===e.type&&(e=e.currentTarget),t||0===t||(t=Math.min(e.value,document.getElementById("sgm-journey-slider-range-input-value-max").value));var n=parseInt(e.min),a=parseInt(e.max),r=100/(a-n)*t-100/(a-n)*n;document.getElementsByClassName("sgm-journey-slider-range-point-min")[0].style.left=r+"%",document.getElementsByClassName("sgm-journey-slider-inverse-left")[0].style.width=r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].style.left=r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].min=r,document.getElementById("sgm-journey-slider-range-point-value-min").parentElement.style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-min").innerHTML=""+t,document.getElementById("price-range-min").value=t;var i=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-item-custom");i&&(i.classList.add("sgm-journey-content-selected"),i.setAttribute("data-original-value",document.getElementById("price-range-min").value+" - "+document.getElementById("price-range-max").value))}function l(e,t){"input"===e.type&&(e=e.currentTarget),t||0===t||(t=Math.max(e.value,document.getElementById("sgm-journey-slider-range-input-value-min").value));var n=parseInt(e.min),a=parseInt(e.max),r=100/(a-n)*parseInt(t)-100/(a-n)*n;document.getElementsByClassName("sgm-journey-slider-inverse-right")[0].style.width=100-r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].style.right=100-r+"%",document.getElementsByClassName("sgm-journey-slider-range-fill")[0].max=r,document.getElementsByClassName("sgm-journey-slider-range-point-max")[0].style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-max").parentElement.style.left=r+"%",document.getElementById("sgm-journey-slider-range-point-value-max").innerHTML=""+t,document.getElementById("price-range-max").value=t;var i=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-content-item-custom");i&&(i.classList.add("sgm-journey-content-selected"),i.setAttribute("data-original-value",document.getElementById("price-range-min").value+" - "+document.getElementById("price-range-max").value))}document.getElementById("sgm-journey-slider-range-input-value-min").min=c,document.getElementById("sgm-journey-slider-range-input-value-min").max=g,document.getElementById("sgm-journey-slider-range-input-value-min").value=s,document.getElementById("sgm-journey-slider-range-input-value-max").min=c,document.getElementById("sgm-journey-slider-range-input-value-max").max=g,document.getElementById("sgm-journey-slider-range-input-value-max").value=o,m(document.getElementById("sgm-journey-slider-range-input-value-max"),s),l(document.getElementById("sgm-journey-slider-range-input-value-min"),o),document.getElementById("sgm-journey-slider-range-input-value-min").addEventListener("input",m.bind(this)),document.getElementById("sgm-journey-slider-range-input-value-max").addEventListener("input",l.bind(this))}},_jbOnDataSelectHandler:function(e,t){var n=_SgmntfY_._jbIsCheckMarkDataSelect()?"sgm-journey-checkmark":"sgm-journey-content-selected";if(_SgmntfY_._jbIsSingleDataSelect()){var a=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+n);a&&a.length>0&&a.forEach(function(e){e.classList.remove("sgm-journey-content-selected")}),t.currentTarget.classList.add("sgm-journey-content-selected"),_SgmntfY_._jbIsAllowedToChangeStepAfterSelect()&&_SgmntfY_._jbOnStepChangeHandler(e)}else{t.currentTarget.classList.contains(n)?t.currentTarget.classList.remove(n):t.currentTarget.classList.add(n);var r=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+n),i=r&&r.length>0,s=_SgmntfY_._jbGetCurrentStepData(e,!1);!_SgmntfY_._variables.journey.nextStep&&i&&_SgmntfY_._jbActionButtonHandler("finish",s,!0),!_SgmntfY_._variables.journey.nextStep&&!i&&_SgmntfY_._jbActionButtonHandler("skipAndFinish",s,!0),_SgmntfY_._variables.journey.nextStep&&i&&_SgmntfY_._jbActionButtonHandler("next",s,!0),_SgmntfY_._variables.journey.nextStep&&!i&&_SgmntfY_._jbActionButtonHandler("skip",s,!0)}},_jbActionButtonHandler:function(e,t,n){var a=document.querySelector(_SgmntfY_._variables.journey.wrapperSelector+" .sgm-journey-action .sgm-journey-discovery-action");a&&(!0===n?(a.classList.remove("sgm-journey-none"),a.setAttribute("data-type",e),a.textContent=_SgmntfY_._jbGetButtonText(t.type,t.buttonTextMap)[e]||""):a.classList.add("sgm-journey-none"))},_jbIsSingleDataSelect:function(){return"MAIN_CATEGORY"===_SgmntfY_._variables.journey.currentStep||"CATEGORY"===_SgmntfY_._variables.journey.currentStep},_jbIsCheckMarkDataSelect:function(){return"COLOR"===_SgmntfY_._variables.journey.currentStep},_jbIsAllowedToChangeStepAfterSelect:function(){return"MAIN_CATEGORY"===_SgmntfY_._variables.journey.currentStep||"CATEGORY"===_SgmntfY_._variables.journey.currentStep},_jbOnStepChangeHandler:function(e){var t=_SgmntfY_._jbIsCheckMarkDataSelect()?"sgm-journey-checkmark":"sgm-journey-content-selected",n=[],a=document.querySelectorAll(_SgmntfY_._variables.journey.wrapperSelector+" ."+t);a&&a.length>0&&a.forEach(function(e){e.hasAttribute("data-original-value")&&n.push(e.getAttribute("data-original-value"))}),_SgmntfY_._jbPrepareJourneyAnswer(n);var r={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:select",r),_SgmntfY_._jbOnStepViewHandler(e)},_jbPrepareJourneyAnswer:function(e){switch(_SgmntfY_._variables.journey.currentStep){case"MAIN_CATEGORY":_SgmntfY_._variables.journey.answer.mainCategory=e[0];break;case"CATEGORY":_SgmntfY_._variables.journey.answer.category=e[0];break;case"BRAND":_SgmntfY_._variables.journey.answer.brand=e;break;case"SIZE":_SgmntfY_._variables.journey.answer.size=e;break;case"COLOR":_SgmntfY_._variables.journey.answer.color=e;break;case"PRICE_RANGE":e&&e.length>0&&(e=e.map(function(e){return e.replace("+"," - ")})),_SgmntfY_._variables.journey.answer.priceRange=e}},_jbExitHandler:function(){var e={step:_SgmntfY_._variables.journey.currentStep,instanceId:_SgmntfY_._variables.journey.instanceId,answer:JSON.stringify(_SgmntfY_._variables.journey.answer)};_SgmntfY_._variables.segmentifyObj("journey:exit",e),_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1)},_getDistinctArray:function(e){return e&&e.length>0?e.filter(function(t,n){return t&&e.indexOf(t)===n}):[]},_campaigns:{NEWSLETTER:function(campaign,request){var config={title:campaign.title,description:campaign.description,placeholder:campaign.placeholder,termsUrl:campaign.termsUrl,termsText:campaign.termsText,buttonSubmitText:campaign.buttonSubmitText,buttonThanksText:campaign.buttonThanksText,buttonBgColor:campaign.buttonBgColor,buttonTextColor:campaign.buttonTextColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Newsletter popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove()},1e3)}),_SgmntfY_._getJq()(".seg-form-submit").bind("click",function(e){_SgmntfY_._getJq()(".seg-form-input").removeClass("seg-form-invalid"),_SgmntfY_._getJq()(".seg-email-collection .seg-checkbox").removeClass("seg-form-invalid"),e.preventDefault();var t=_SgmntfY_._getJq()(".seg-form-input"),n=_SgmntfY_._getJq()('.seg-email-collection .seg-form-footer input[type="checkbox"]');if(isEmail(t.val())&&1==n.is(":checked")){_SgmntfY_._getJq()(this).addClass("seg-sending"),_SgmntfY_._getJq()(this).css({"pointer-events":"none"}),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("segFadeOutDown")},3e3),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").remove()},6e3);var a=_SgmntfY_._getJq()("#seg-email-collection");a.length>0&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:campaign.name,instanceId:campaign.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm()}))}isEmail(t.val())||t.addClass("seg-form-invalid"),0==n.is(":checked")&&_SgmntfY_._getJq()(".seg-terms .seg-checkbox").addClass("seg-form-invalid")});var isEmail=function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}},FORM:function(campaign,request){for(var config={title:campaign.title,description:campaign.description,buttonSubmitText:campaign.buttonSubmitText,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition},fields=campaign.fields||[],i=0;i<fields.length;++i){var field=fields[i];config["ff"+i+"_required"]=field.required,"INPUT"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,config["ff"+i+"_inputType"]=field.inputType,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="input-"+i):"TEXT_AREA"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="textarea-"+i):"CHECKBOX"!==field.type&&"RADIO_BUTTON"!==field.type||(config["ff"+i+"_groupTitle"]=field.groupTitle,config["ff"+i+"_options"]=field.options,field.groupTitle?config["ff"+i+"_fieldName"]=field.groupTitle:"CHECKBOX"===field.type?config["ff"+i+"_fieldName"]="checkbox-"+i:config["ff"+i+"_fieldName"]="radiobutton-"+i)}try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Form popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-form-survey").each(function(){var e=_SgmntfY_._getJq()(this);-1===e.attr("class").indexOf("cmp_")&&e.addClass(campaign.instanceId)}),"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-form-submit").bind("click",function(e){e.preventDefault();var t=_SgmntfY_._getJq()(this),n=_SgmntfY_._getJq()("."+campaign.instanceId+".seg-form-survey"),a=n.find(".seg-form");checkValidity(a)&&(t.addClass("seg-sending"),t.css({"pointer-events":"none"}),setTimeout(function(){n.addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){n.addClass("segFadeOutDown")},3e3),setTimeout(function(){n.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},6e3),a.length>0&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:campaign.name,instanceId:campaign.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm()})))});var checkValidity=function(e){try{e.find(".seg-form-invalid").removeClass("seg-form-invalid");for(var t=e.find("input,textarea"),n=!0,a=0;a<t.length;++a){var r=t[a],i=_SgmntfY_._getJq()(r);"checkbox"!==i.attr("type")&&(r.checkValidity()||("radio"===i.attr("type")?i.parent().addClass("seg-form-invalid"):i.addClass("seg-form-invalid"),n=!1))}var s=e.find('input[type="checkbox"]'),o=[];s.each(function(){-1==o.indexOf(this.name)&&o.push(this.name)});for(var _=0;_<o.length;++_)e.find('input[name="'+o[_]+'"]:required').length>0&&0==e.find('input[name="'+o[_]+'"]:checked').length&&(e.find('input[name="'+o[_]+'"]').parent().addClass("seg-form-invalid"),n=!1);return n}catch(e){return!0}}},POPUP_BANNER:function(campaign,request){var config={title:campaign.title,image:campaign.image,url:campaign.url,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._getJq()(".seg-banner-container img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId})},NOTIFICATION_BAR:function(campaign,request){var config={title:campaign.title,image:campaign.image,bgColor:campaign.bgColor,textColor:campaign.textColor,url:campaign.url,instanceId:campaign.instanceId,divClass:"sgf-notif-bar-"+(campaign.verticalPosition||"top")};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Bar appended to html body for campaign("+campaign.instanceId+")"),"true"===campaign.sticky&&(_SgmntfY_._getJq()(".seg-notification-bar").addClass("seg-notification-bar-sticky"),_SgmntfY_._getJq()(".seg-notification-bar-sticky:not([data-loaded])").each(function(){var e=_SgmntfY_._getJq()(this);if(e.attr("data-loaded","true"),e.find("img").length){var t=e.find("img:first"),n=t.attr("src")||t.attr("data-src");t.on("load",function(){var e=_SgmntfY_._getJq()(this).parents(".seg-notification-bar:first"),t=parseInt(_SgmntfY_._getJq()("body").css("padding-top").replace("px","")),n=parseInt(_SgmntfY_._getJq()("body").css("padding-bottom").replace("px",""));e.hasClass("sgf-notif-bar-top")?t+=e.height():e.hasClass("sgf-notif-bar-bottom")&&(n+=e.height()),_SgmntfY_._getJq()("body").css("padding-top",t).css("padding-bottom",n)}),t[0].src=n}})),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).length?_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}):_SgmntfY_._getJq()(".sgf-link").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})})},PUSH_PERMISSION:function(campaign,request){var config={title:campaign.title,text:campaign.text,icon:campaign.icon,buttonLaterText:campaign.buttonLaterText,buttonAllowText:campaign.buttonAllowText,safariEnabled:campaign.safariEnabled,swPath:campaign.serviceWorkerPath};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}try{var _pushPermissionKey=_SgmntfY_._getPersistentData(_SgmntfY_._variables.pushPermissionKey);if(_pushPermissionKey&&_SgmntfY_._isNotEmpty(_pushPermissionKey)&&"true"===_pushPermissionKey)return;var frequency=campaign.frequency;frequency&&("SESSION"===frequency.type?_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",0):"LIFETIME"===frequency.type?_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",390):"DAYS"===frequency.type&&_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",frequency.param))}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while checking campaign frequency:"+e),_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",0)}try{campaign.postJs&&eval(campaign.postJs),/OPR/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Opera":/YaBrowser/i.test(navigator.userAgent)||/Yowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Yandex":/SamsungBrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Samsung":/ucbrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="UCBrowser":/Chrome/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Chrome":/Firefox/i.test(navigator.userAgent)&&(_SgmntfY_._variables.pushInfo.agent="Firefox"),"safari"in window&&"pushNotification"in window.safari&&(_SgmntfY_._variables.pushInfo.agent="Safari"),"Chrome"!==_SgmntfY_._variables.pushInfo.agent&&"Opera"!==_SgmntfY_._variables.pushInfo.agent&&"Yandex"!==_SgmntfY_._variables.pushInfo.agent&&"Samsung"!==_SgmntfY_._variables.pushInfo.agent&&"UCBrowser"!==_SgmntfY_._variables.pushInfo.agent&&"Firefox"!==_SgmntfY_._variables.pushInfo.agent||(_SgmntfY_._variables.pushInfo.isFirebaseCompatible=!0),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod&&_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&_SgmntfY_._getJq().getScript(_SgmntfY_._variables.pushInfo.firebase.scriptUrl,function(){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&(firebase.apps.length||firebase.initializeApp({apiKey:_SgmntfY_._variables.pushInfo.firebase.apiKey,messagingSenderId:_SgmntfY_._variables.pushInfo.firebase.messagingSenderId}),_SgmntfY_._variables.pushInfo.messaging=firebase.messaging()),"serviceWorker"in navigator&&navigator.serviceWorker.register(config.swPath,{updateViaCache:"none"}).then(function(e){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&firebase.messaging().useServiceWorker(e),_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker "+e)})}),"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._pushInitPermissionCampaign(campaign,config),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod&&"serviceWorker"in navigator&&navigator.serviceWorker.register(config.swPath,{updateViaCache:"none"}).then(function(e){_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker in vapid method"+e)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while executing PUSH_PERMISSION campaign "+e)}},HERO_BANNER:function(campaign){var config={title:campaign.title,url:campaign.url,image:campaign.image,instanceId:campaign.instanceId},_instanceId=campaign.instanceId,wvCB=function(e){var t=!1;if(!t&&_SgmntfY_._isElemVisible(e))_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0;else if(!t)var n=setInterval(function(){!t&&_SgmntfY_._isElemVisible(e)&&(_SgmntfY_._interaction("widget-view",_instanceId,_instanceId),t=!0,window.clearInterval(n))},100)};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);try{var _target=campaign.targetSelector,targetElement=_SgmntfY_._getJq()(_target).first(),_targetPosition=campaign.targetPosition;if("SELF"===_targetPosition)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-hero-banner-wrapper seg-clear"});"AFTER"===_targetPosition||"BEFORE"===_targetPosition?"AFTER"===_targetPosition?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==_targetPosition&&"PREPEND"!==_targetPosition||("APPEND"===_targetPosition?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element ["+_target+"] for banner: "+e)}campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Hero Banner inserted to html for campaign("+_instanceId+")"),_SgmntfY_._interaction("impression",_instanceId,_instanceId),_SgmntfY_._getJq()(".seg-hero-banner-link-"+_instanceId).length&&_SgmntfY_._getJq()(".seg-hero-banner-link-"+_instanceId).bind("click",function(){_SgmntfY_._interaction("click",_instanceId,_instanceId)})}},_functions:{getFunction:function(e){switch(e.toLowerCase()){case"apikey":return _SgmntfY_._functions.setApiKey;case"loglevel":return _SgmntfY_._functions.setLogLevel;case"variables":return _SgmntfY_._functions.setVariables;case"userid":return _SgmntfY_._functions.setUserId;case"view:page":return _SgmntfY_._functions.pageView;case"view:product":return _SgmntfY_._functions.productView;case"basket:add":return _SgmntfY_._functions.addToBasket;case"basket:remove":return _SgmntfY_._functions.removeFromBasket;case"basket:clear":return _SgmntfY_._functions.clearBasket;case"checkout:basket":return _SgmntfY_._functions.checkoutViewBasket;case"checkout:customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"checkout:payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"checkout:purchase":return _SgmntfY_._functions.checkoutPurchase;case"user:signin":return _SgmntfY_._functions.userSignIn;case"user:signout":return _SgmntfY_._functions.userSignOut;case"user:signup":return _SgmntfY_._functions.userSignUp;case"user:subscribe":return _SgmntfY_._functions.userSubscribe;case"user:unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"user:update":return _SgmntfY_._functions.userInfoUpdate;case"event:custom":return _SgmntfY_._functions.customEvent;case"event:interaction":return _SgmntfY_._functions.interaction;case"user:form":return _SgmntfY_._functions.userForm;case"banner:impression":return _SgmntfY_._functions.bannerImpression;case"banner:click":return _SgmntfY_._functions.bannerClick;case"banner:update":return _SgmntfY_._functions.bannerUpdate;case"bannergroup:view":return _SgmntfY_._functions.bannerGroupView;case"bannergroup:detail":return _SgmntfY_._functions.bannerGroupDetail;case"impression:promotion":return _SgmntfY_._functions.promotionImpression;case"view:promotion":return _SgmntfY_._functions.promotionView;case"push:click:interaction":return _SgmntfY_._functions.pushInteraction;case"search":return _SgmntfY_._functions.search;case"filter":return _SgmntfY_._functions.filter;case"coupon":return _SgmntfY_._functions.coupon;case"email:click":return _SgmntfY_._functions.mailClickInteraction;case"ga:event":return _SgmntfY_.GA.sendEvent;case"journey:init":return _SgmntfY_._functions.initJourney;case"journey:success":return _SgmntfY_._functions.successJourney;case"journey:start":return _SgmntfY_._functions.startJourney;case"journey:view":return _SgmntfY_._functions.viewJourney;case"journey:select":return _SgmntfY_._functions.selectJourney;case"journey:exit":return _SgmntfY_._functions.exitJourney;case"journey:skip":return _SgmntfY_._functions.skipJourney;case"journey:finish":return _SgmntfY_._functions.finishJourney;default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},getDataLayerFunction:function(e,t){switch(e.toLowerCase()){case"page":return _SgmntfY_._functions.pageView;case"product":return _SgmntfY_._functions.productView;case"basket":switch(t.step.toLowerCase()){case"add":return _SgmntfY_._functions.addToBasket;case"remove":return _SgmntfY_._functions.removeFromBasket;case"clear":return _SgmntfY_._functions.clearBasket;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Basket Operations Step: "+e.step)}}case"checkout":switch(t.step.toLowerCase()){case"basket":return _SgmntfY_._functions.checkoutViewBasket;case"customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"purchase":return _SgmntfY_._functions.checkoutPurchase;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Checkout Step: "+e.step)}}case"user":switch(t.step.toLowerCase()){case"signin":return _SgmntfY_._functions.userSignIn;case"signout":return _SgmntfY_._functions.userSignOut;case"signup":return _SgmntfY_._functions.userSignUp;case"subscribe":return _SgmntfY_._functions.userSubscribe;case"unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"update":return _SgmntfY_._functions.userInfoUpdate;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected User Operations Step: "+e.step)}}case"interaction":return _SgmntfY_._functions.interaction;case"form":return _SgmntfY_._functions.userForm;case"banners":return _SgmntfY_._functions.bannerGroupView;case"banner":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.bannerImpression;case"click":return _SgmntfY_._functions.bannerClick;case"update":return _SgmntfY_._functions.bannerUpdate;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Banner Operations Type: "+e.type)}}case"custom":return _SgmntfY_._functions.customEvent;case"promotion":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.promotionImpression;case"view":return _SgmntfY_._functions.promotionView;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Promotion Type: "+e.type)}}default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},callFunction:function(e){var t=[];e=e||[];for(var n=0;n<e.length;n++){var a=e[n],r=_SgmntfY_._functions.getFunction(a[0]),i=Array.prototype.slice.call(a,1);try{var s=r.apply(null,i);s&&(t=t.concat(s)),_SgmntfY_.LOG_MESSAGE("INFO","Event triggered: "+a[0])}catch(e){_SgmntfY_.LOG_MESSAGE("Error","Can't convert command("+a[0]+") into request data. Details: "+e)}}_SgmntfY_._sendRequestToServer(t)},setApiKey:function(e,t){if(_SgmntfY_._variables.apiKey=e,_SgmntfY_.LOG_MESSAGE("DEBUG","Api Key: "+e),t)_SgmntfY_.LOG_MESSAGE("INFO","Account specific style is disabled, skipping...");else{var n=_SgmntfY_._variables.segmentifyCDNUrl+e+"/segmentify.css";_SgmntfY_.LOG_MESSAGE("INFO","Loading account specific css file: "+n),_SgmntfY_._loadCSS(n)}_SgmntfY_._isNotEmpty(_SgmntfY_._variables.apiKey)&&(_SgmntfY_._consumeNextPageQueue(),_SgmntfY_._consumeRetryQueue()),_SgmntfY_._variables.ga.enabled&&_SgmntfY_.GA.activate()},setLogLevel:function(e){var t=_SgmntfY_.LOG_LEVELS[e];void 0!==t&&(_SgmntfY_._variables.logLevel=t,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Log Level Changed to: "+e))},setVariables:function(e){e=e||{},_SgmntfY_._extend(_SgmntfY_._variables,e),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Variables are updated - New Values: "+e)},setUserId:function(e){var t=_SgmntfY_._getUserId();if(_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,e,390,_SgmntfY_._variables.storage.user.local),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify User Id Changed to: "+e),t!==e){var n={};return n.oldUserId=t||"",n.async="false",_SgmntfY_._prepareRequest(n,"USER_CHANGE")}},pageView:function(e){return e=e||{},_SgmntfY_.GA.sendPageView(e.category||""),_SgmntfY_._prepareRequest(e,"PAGE_VIEW")},productView:function(e){if((e=e||{}).url=_SgmntfY_._clearProductUrl(e.url||document.URL),e.productUrl=e.productUrl||e.url||document.URL,"number"==typeof e.productId&&(e.productId=e.productId.toString()),"string"==typeof e.categories)if(-1!==e.categories.indexOf("|")){var t=e.categories.split("|");for(var n in e.categories=[],t)t.hasOwnProperty(n)&&e.categories.push(t[n].trim())}else e.categories=[e.categories];else for(var a in e.categories)e.categories.hasOwnProperty(a)&&"string"==typeof e.categories[a]&&(e.categories[a]=e.categories[a].trim());e.categories=(e.categories||[]).filter(_SgmntfY_._null),e.source=e.source||_SgmntfY_._sourceOfUrl();var r=_SgmntfY_._getClickedBanners();if(r.length>0){var i=[];for(a=0;a<r.length;++a){var s=_SgmntfY_._split(r[a],":",4);4!==s.length||isNaN(parseInt(s[2]))||i.push({title:s[0],group:s[1],order:parseInt(s[2])})}e.activeBanners=i}return _SgmntfY_._variables.skipProductDetail.device.indexOf(_SgmntfY_._variables.ua.type)>=0&&(e.noUpdate=["all"]),_SgmntfY_._prepareRequest(e,"PRODUCT_VIEW")},addToBasket:function(e){(e=e||{}).step="add",e.async="false",e.quantity=e.quantity||1;var t=_SgmntfY_._getClickedBanners();if(t.length>0){for(var n=[],a=0;a<t.length;++a){var r=_SgmntfY_._split(t[a],":",4);4!==r.length||isNaN(parseInt(r[2]))||n.push({title:r[0],group:r[1],order:parseInt(r[2])})}e.activeBanners=n}return _SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},removeFromBasket:function(e){return(e=e||{}).step="remove",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},clearBasket:function(e){return(e=e||{}).step="clear",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},checkoutViewBasket:function(e){if((e=e||{}).step="view-basket",e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;return e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutCustomerInfo:function(e){return(e=e||{}).step="customer-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPaymentInfo:function(e){return(e=e||{}).step="payment-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPurchase:function(e){if((e=e||{}).step="purchase",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;var n=_SgmntfY_._getClickedBanners();if(n.length>0){for(var a=[],r=0;r<n.length;++r){var i=_SgmntfY_._split(n[r],":",4);4!==i.length||isNaN(parseInt(i[2]))||a.push({title:i[0],group:i[1],order:parseInt(i[2])})}e.activeBanners=a}return _SgmntfY_._prepareRequest(e,"CHECKOUT")},userSignIn:function(e){return(e=e||{}).step="signin",e.async="false",e.isLogin=!0,e.isRegistered=!0,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignOut:function(e){return(e=e||{}).step="signout",e.async="false",e.isLogin=!1,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignUp:function(e){return(e=e||{}).step="signup",e.async="false",e.isRegistered=!0,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSubscribe:function(e){return(e=e||{}).step="subscribe",e.async="false",_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userUnsubscribe:function(e){return(e=e||{}).step="unsubscribe",e.async="false",_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userInfoUpdate:function(e){(e=e||{}).step="update",e.async="false",void 0!==e.isLogin&&(e.isRegistered="true"===e.isLogin||!0===e.isLogin?"true":e.isRegistered);var t=JSON.stringify(e),n=_SgmntfY_._getPersistentData("sgfUserUpdateData",!0);if(void 0===n||t!==n)return _SgmntfY_._storePersistentData("sgfUserUpdateData",t,-1,!0),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userForm:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"FORM")},customEvent:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"CUSTOM_EVENT")},search:function(e){var t=(e=e||{}).params||{};return t._search_beta_=_SgmntfY_._getSearchBetaMode(),t._search_no_cache_=_SgmntfY_._getSearchNoCache(),e.params=t,_SgmntfY_._prepareRequest(e,"SEARCH")},interaction:function(e){return(e=e||{}).async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),"impression"!==e.type&&"widget-view"!==e.type&&"push-permission-impression"!==e.type&&"push"!==e.type&&"email"!==e.type&&"slider:arrow:left"!==e.type&&"slider:arrow:right"!==e.type||(e.nextPage=!1),_SgmntfY_._prepareRequest(e,"INTERACTION")},bannerImpression:function(e){return(e=e||{}).async="false",e.type="impression",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerClick:function(e){return(e=e||{}).async="false",e.type="click",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),_SgmntfY_._addClickedBanner(e.title,e.group,e.order,e.url),_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerUpdate:function(e){return(e=e||{}).async="false",e.type="update",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerGroupView:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"BANNER_GROUP_VIEW")},bannerGroupDetail:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"INTERNAL_BANNER_GROUP")},promotionImpression:function(e){return(e=e||{}).type="impression","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},promotionView:function(e){return(e=e||{}).type="view","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},pushInteraction:function(e){return(e=e||{}).async="false",e.nextPage="false",_SgmntfY_._storePersistentData(e.instanceId,"1",.006),_SgmntfY_.LOG_MESSAGE("DEBUG","Push campaign interaction is sent for campaign: "+e.instanceId),_SgmntfY_._prepareRequest(e,"INTERACTION")},filter:function(e){return(e=e||{}).categories=(e.categories||[]).filter(_SgmntfY_._null),e.brands=(e.brands||[]).filter(_SgmntfY_._null),e.sizes=(e.sizes||[]).filter(_SgmntfY_._null),e.prices=(e.prices||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"FILTER")},coupon:function(e){return(e=e||{}).nextPage="false",_SgmntfY_._prepareRequest(e,"COUPON")},mailClickInteraction:function(e){return(e=e||{}).async="false",e.nextPage="false",_SgmntfY_._storePersistentData(e.instanceId+"_email","1",.006),_SgmntfY_._prepareRequest(e,"INTERACTION")},initJourney:function(e){return(e=e||{}).type="INIT",_SgmntfY_._prepareRequest(e,"JOURNEY")},successJourney:function(e){return(e=e||{}).type="SUCCESS",_SgmntfY_._prepareRequest(e,"JOURNEY")},startJourney:function(e){return(e=e||{}).type="START",_SgmntfY_._prepareRequest(e,"JOURNEY")},viewJourney:function(e){return(e=e||{}).type="VIEW",_SgmntfY_._prepareRequest(e,"JOURNEY")},selectJourney:function(e){return(e=e||{}).type="SELECT",_SgmntfY_._prepareRequest(e,"JOURNEY")},exitJourney:function(e){return(e=e||{}).type="EXIT",_SgmntfY_._prepareRequest(e,"JOURNEY")},skipJourney:function(e){return(e=e||{}).type="SKIP",_SgmntfY_._prepareRequest(e,"JOURNEY")},finishJourney:function(e){return(e=e||{}).type="FINISH",_SgmntfY_._prepareRequest(e,"JOURNEY")}},_bindRecommendationTrackEvents:function(e,t,n,a){if(!(a>10)){a+=1;var r=t&&t.sliderClick,i=r&&t.sliderClick.leftArrowSelector,s=r&&t.sliderClick.rightArrowSelector;if(i&&s){var o=e.find(i),_=e.find(s);0===o.length||0===_.length?setTimeout(_SgmntfY_._bindRecommendationTrackEvents,200,e,t,n,a):(o.on("click",function(){_SgmntfY_._sendSliderClick(n,"left")}),_.on("click",function(){_SgmntfY_._sendSliderClick(n,"right")}))}}},_sendSliderClick:function(e,t){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"slider:arrow:"+t,interactionId:"slider:arrow:"+t,instanceId:e}),_SgmntfY_.GA.sendArrowClick(e,t)},_prepareRequest:function(e,t,n){if(void 0===e.noSend||"true"!==e.noSend)if(_SgmntfY_._getJq()("html").hasClass("translated-ltr")||_SgmntfY_._getJq()("html").hasClass("translated-rtl"))_SgmntfY_.LOG_MESSAGE("DEBUG","Page is translated, ignoring event");else if(navigator&&navigator.language&&"c"===navigator.language)_SgmntfY_.LOG_MESSAGE("DEBUG","This is a bot, ignoring event");else if(_SgmntfY_._isEmpty(_SgmntfY_._variables.apiKey))_SgmntfY_.LOG_MESSAGE("ERROR","Api Key is not set, not sending event: "+t);else if(_SgmntfY_._isEmpty(_SgmntfY_._getUserId()))_SgmntfY_.LOG_MESSAGE("ERROR","userId is not set, not sending event: "+t);else{if(!_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())){if(void 0===n&&(n=!1),!n&&"boolean"==typeof e.nextPage&&!0===e.nextPage)return _SgmntfY_._addToNextPageQueue({eventName:t,params:e}),null;var a=new Date,r={data:{name:t,userId:_SgmntfY_._getUserId(),sessionId:_SgmntfY_._getSessionId(),testMode:_SgmntfY_._getTestMode()||"false",device:_SgmntfY_._variables.ua.type||"PC",noProcess:e.noProcess||!1,tryCount:0,nextPage:e.nextPage||!1,params:e.params||{},recommendIds:(e.recommendIds||[]).filter(_SgmntfY_._null),pageUrl:e.pageUrl||document.URL,referrer:e.referrer||document.referrer,browser:e.browser||_SgmntfY_._variables.ua.name,os:e.os||_SgmntfY_._variables.ua.os,osversion:e.osversion||_SgmntfY_._variables.ua.osversion,userAgent:e.userAgent||_SgmntfY_._variables.ua.agentString,lang:e.lang||_SgmntfY_._variables.language,currency:e.currency||_SgmntfY_._variables.currency,region:e.region||_SgmntfY_._variables.region,async:e.async||"true",email:e.email||"",ft:_SgmntfY_._getFireTime(a)||"",tz:_SgmntfY_._getTimeZone(a)||""},originalParams:e,eventName:t};"function"==typeof e.recommendationCallback&&_SgmntfY_._getJq().extend(r,{recommendationCallback:e.recommendationCallback});for(var i=_SgmntfY_._variables.requiredParams[t],s=0;s<i.length;++s){if(!_SgmntfY_._isNotEmpty(e[i[s]]))return void _SgmntfY_.LOG_MESSAGE("ERROR","Missing parameter["+i[s]+"] in event: "+t);r.data[i[s]]=e[i[s]],"string"==typeof r.data[i[s]]&&(r.data[i[s]]=_SgmntfY_._clearNullByte(r.data[i[s]]).trim())}var o=_SgmntfY_._variables.optionalParams[t];for(s=0;s<o.length;++s)_SgmntfY_._isNotEmpty(e[o[s]])&&(r.data[o[s]]=e[o[s]],"string"==typeof r.data[o[s]]&&(r.data[o[s]]=_SgmntfY_._clearNullByte(r.data[o[s]]).trim()));return r}_SgmntfY_.LOG_MESSAGE("ERROR","sessionId is not set, not sending event: "+t)}else _SgmntfY_.LOG_MESSAGE("DEBUG","No send flag is set for event: "+t+", ignoring event")},_storePersistentData:function(e,t,n,a){if("undefined"!=typeof Storage&&a)try{localStorage.setItem(e,t),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Local Storage) Update: "+e+": "+t)}catch(n){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Local Storage) Update: "+e+": "+t)}else{"string"==typeof t&&(t=encodeURIComponent(t));var r,i,s="",o="";n&&((r=new Date).setTime(r.getTime()+24*n*60*60*1e3),s="; expires="+r.toGMTString()),_SgmntfY_._variables.domain&&_SgmntfY_._variables.domain.split(".").length>=2&&(o="; domain="+_SgmntfY_._variables.domain),i=e+"="+t+s+o+"; path=/";try{document.cookie=i,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Cookie) Update: "+i)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Cookie) Update: "+i)}}},_getPersistentData:function(e,t){if("undefined"!=typeof Storage&&t)try{return localStorage.getItem(e)}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Local Storage): "+e),null}else{var n=e+"=";try{for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var i=a[r].trim();if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Cookie): "+e),null}}},_clearProductUrl:function(e){return _SgmntfY_._stripQueryParameters(e,["_sgm_source","_sgm_campaign","_sgm_action","_sgm_type","_sgm_test","utm_source","utm_medium","utm_term","utm_content","utm_campaign","utm_type","p_id","gclid","ds_p","ds_eid","ds_aid","ds_e","ds_c","ds_cid","ds_ag","ds_agid","ds_k","ds_kid","ds_kids","ds_kidnl","gclick","gsrc","gclsrc","_sgm_coupon","_sgm_term"])},_stripQueryParameters:function(e,t){if(void 0===t||!t)return e;"string"==typeof t&&(t=[t]);var n=(e||"").split("?");if(n.length>=2){for(var a=[],r=0;r<(t||[]).length;r++)a.push(encodeURIComponent(t[r])+"=");var i=n[1].split(/[&;]/g);for(r=i.length;r-- >0;)for(var s=0;s<a.length;s++)if(-1!==i[r].lastIndexOf(a[s],0)){i.splice(r,1);break}return i.length>0?n[0]+"?"+i.join("&"):n[0]}return e},_getQueryParameter:function(e,t){var n=location.search;if(this._isEmpty(n)){var a=location.hash;this._isNotEmpty(a)&&-1!==a.indexOf("?")&&(n=a.substring(a.indexOf("?")))}void 0!==t&&(n=t),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#?]*)").exec(n);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},_sendTrackedEvent:function(e){var t,n,a,r,i,s=_SgmntfY_._getQueryParameter("_sgm_push_redirect_url",e);if(s&&0!==s.length&&(window.location=s),"segmentify"===_SgmntfY_._getQueryParameter("utm_source",e)?(t=_SgmntfY_._getQueryParameter("utm_campaign",e),n=_SgmntfY_._getQueryParameter("utm_medium",e),a=_SgmntfY_._getQueryParameter("utm_content",e)):(t=_SgmntfY_._getQueryParameter("_sgm_campaign",e),n=_SgmntfY_._getQueryParameter("_sgm_action",e),a=_SgmntfY_._getQueryParameter("_sgm_source",e)),r=_SgmntfY_._getQueryParameter("_sgm_coupon",e),i=_SgmntfY_._getQueryParameter("_sgm_term",e),"push"===n){var o=_SgmntfY_._getPersistentData(t);(_SgmntfY_._isEmpty(o)||_SgmntfY_._isNotEmpty(o)&&"0"===o)&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a+" - type: push-click"),_SgmntfY_._variables.segmentifyObj("push:click:interaction",{type:"push-click",interactionId:a,instanceId:t}))}if("email"===n){o=_SgmntfY_._getPersistentData(t+"_email");(_SgmntfY_._isEmpty(o)||_SgmntfY_._isNotEmpty(o)&&"0"===o)&&_SgmntfY_._variables.segmentifyObj("email:click",{type:"email-click",interactionId:a,instanceId:t})}var _={};i&&(_.term=i),t&&n&&a&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:n,interactionId:a,instanceId:t,params:_}),"push"===n&&r&&_SgmntfY_._variables.segmentifyObj("coupon",{type:n,interactionId:a,instanceId:t}),"click"===n&&_SgmntfY_.GA.sendProductClick(t,a))},_setTestMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgm_test");if(_SgmntfY_._toggleTestMode(t),"exists"!==_SgmntfY_._getExtensionStatus("test")&&"true"===_SgmntfY_._getTestMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>Chrome Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-test-mode-message"> Your browser is in<strong>Segmentify Test Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleTestMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show test mode header: "+e)}},_getTestMode:function(){return _SgmntfY_._getPersistentData(_SgmntfY_._variables.testMode)},_toggleTestMode:function(e){"on"===e?(_SgmntfY_._getJq()("#sgm-test-mode-message").html("Your browser is in<strong>Segmentify Test Mode</strong>"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode activated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"true",180)):"off"===e&&(_SgmntfY_._getJq()("#sgm-test-mode-message").html("<strong>Segmentify Test Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode deactivated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"false",180),window.alert("You are out of Segmentify Test Mode, you will not see test campaigns."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgm_test"))},_getTracking:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.tracking);return _SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),e},_setTracking:function(e){"disabled"!==e&&(e="enabled"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.tracking,e,390)},_getQaMode:function(){try{var e=_SgmntfY_._variables.storage.qaMode;return _SgmntfY_._getPersistentData(e.key,e.local)||"false"}catch(e){return _SgmntfY_.LOG_MESSAGE("DEBUG","Can't read QA mode status: "+err),"false"}},_setQaMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgf_qa");if(_SgmntfY_._toggleQaMode(t),"exists"!==_SgmntfY_._getExtensionStatus("qa")&&"true"===_SgmntfY_._getQaMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo-blue"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>QA Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-qa-mode-message"> Your browser is in<strong>Segmentify QA Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleQaMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show test mode header: "+e)}},_toggleQaMode:function(e){var t=_SgmntfY_._variables.storage.qaMode;"on"===e?(_SgmntfY_._getJq()("#sgm-qa-mode-message").html("Your browser is in<strong>Segmentify QA Mode</strong>"),_SgmntfY_._getJq()("#sgm-qa-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify QA Mode activated"),_SgmntfY_._storePersistentData(t.key,"true",180,t.local)):"off"===e&&(_SgmntfY_._getJq()("#sgm-qa-mode-message").html("<strong>Segmentify QA Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-qa-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify QA Mode deactivated"),_SgmntfY_._storePersistentData(t.key,"false",180,t.local),window.alert("You are out of Segmentify QA Mode."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgf_qa"))},_getSearchBetaMode:function(){try{var e=_SgmntfY_._variables.storage.searchBetaMode;return _SgmntfY_._getPersistentData(e.key,e.local)||"false"}catch(e){return _SgmntfY_.LOG_MESSAGE("DEBUG","Can't read Search Beta mode status: "+err),"false"}},_setSearchBetaMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgf_search_beta");if(_SgmntfY_._toggleSearchBetaMode(t),"exists"!==_SgmntfY_._getExtensionStatus("searchBeta")&&"true"===_SgmntfY_._getSearchBetaMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo-blue"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>Search Beta Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-search-beta-mode-message"> Your browser is in <strong>Search Beta Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleSearchBetaMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show search beta mode header: "+e)}},_toggleSearchBetaMode:function(e){var t=_SgmntfY_._variables.storage.searchBetaMode;"on"===e?(_SgmntfY_._getJq()("#sgm-search-beta-mode-message").html("Your browser is in <strong>Search Beta Mode</strong>"),_SgmntfY_._getJq()("#sgm-search-beta-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Search Beta Mode activated"),_SgmntfY_._storePersistentData(t.key,"true",180,t.local)):"off"===e&&(_SgmntfY_._getJq()("#sgm-search-beta-mode-message").html("<strong>Search Beta Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-search-beta-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Search Beta Mode deactivated"),_SgmntfY_._storePersistentData(t.key,"false",180,t.local),window.alert("You are out of Segmentify Search Beta Mode."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgf_search_beta"))},_getSearchNoCache:function(){try{var e=_SgmntfY_._variables.storage.searchNoCache;return _SgmntfY_._getPersistentData(e.key,e.local)||"false"}catch(e){return _SgmntfY_.LOG_MESSAGE("DEBUG","Can't read Search no cache status: "+err),"false"}},_getEventUrl:function(){return"true"===_SgmntfY_._getQaMode()?_SgmntfY_._variables.segmentifyQaApiUrl:_SgmntfY_._variables.segmentifyApiUrl},_getPushUrl:function(){return"true"===_SgmntfY_._getQaMode()?_SgmntfY_._variables.pushInfo.qaDataCenter:_SgmntfY_._variables.pushInfo.dataCenter},_getSessionId:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.sessionStorageKey,_SgmntfY_._variables.storage.session.local);return e?e.trim():""},_getUserId:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.userStorageKey,_SgmntfY_._variables.storage.user.local);return e?e.trim():""},_shuffle:function(e){for(var t,n,a=e.length;a;t=Math.floor(Math.random()*a),n=e[--a],e[a]=e[t],e[t]=n);return e},_getClickedBanners:function(){try{var e=_SgmntfY_._variables.storage.clickedBanners;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read clicked banners: "+e)}return[]},_addClickedBanner:function(e,t,n,a){if(void 0!==e&&void 0!==t&&void 0!==n&&void 0!==a){var r=e+":"+t+":"+n+":"+a,i=_SgmntfY_._getClickedBanners();-1===i.indexOf(r)&&i.push(r),i.length>_SgmntfY_._variables.constants.clickedBannersLimit&&(i=i.splice(i.length-_SgmntfY_._variables.constants.clickedBannersLimit));var s=_SgmntfY_._variables.storage.clickedBanners;_SgmntfY_._storePersistentData(s.key,JSON.stringify(i),0,s.local)}},_getDelayedActions:function(){try{var e=_SgmntfY_._variables.storage.delayedActions;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed actions: "+e)}return[]},_setDelayedActions:function(e){var t=_SgmntfY_._variables.storage.delayedActions;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e.params.actionId)return!1;var a=new Date;if(e.delayDate.getTime()<a.getTime())return!1;var r=e.type,i=_SgmntfY_._actions[e.type],s=e.params,o=e.request;return setTimeout(function(){for(var t=_SgmntfY_._getDelayedActions(),n=!1,a=0;a<t.length;a++)t[a].params.actionId===e.params.actionId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") is triggered after delay"),i.call(null,s,o),_SgmntfY_._removeDelayedAction(s.actionId))},e.delayDate.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedActions(t),!0},_removeDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e)return t.splice(n,1),void _SgmntfY_._setDelayedActions(t)},_getRetryQueue:function(){try{var e=_SgmntfY_._variables.storage.retryQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read retry queue: "+e)}return[]},_setRetryQueue:function(e){var t=_SgmntfY_._variables.storage.retryQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToRetryQueue:function(e){for(var t=_SgmntfY_._getRetryQueue();e.length>0;){var n=e.shift();if("CHECKOUT"===n.eventName||"BASKET_OPERATIONS"===n.eventName||"INTERACTION"===n.eventName){var a=n.data.tryCount||0;a<_SgmntfY_._variables.constants.retryLimit&&(n.data.tryCount=a+1,_SgmntfY_._variables.isUnload&&(n.originalParams.discardResponse="true"),t.push(n))}}_SgmntfY_._setRetryQueue(t)},_consumeRetryQueue:function(){var e=_SgmntfY_._getRetryQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setRetryQueue([])}},_getDataLayer:function(){return window[_SgmntfY_._variables.dataLayer]},_consumeDataLayer:function(){if(_SgmntfY_._variables.consumeDataLayer){var e=[],t=function(t,n){if(!n.hasOwnProperty("__processed__")||!0!==n.__processed__){var a=_SgmntfY_._extend(n,r),i=_SgmntfY_._functions.getDataLayerFunction(t,a).apply(null,[a]);i&&e.push(i)}},n=function(e,t){var n=JSON.parse(JSON.stringify(t)),a=_SgmntfY_._variables.dataLayerConfig[e]||{};for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(n.hasOwnProperty(i)){var s=n[i];delete n[i],n[r]=s}}return n},a=_SgmntfY_._getDataLayer()||{},r=n("common",a.common||{});if(r.hasOwnProperty("userId")){var i=_SgmntfY_._functions.setUserId(r.userId);i&&(e.push(i),delete _SgmntfY_._getDataLayer().common.userId)}for(var s in a)if(a.hasOwnProperty(s)){if("common"===s)continue;if(_SgmntfY_._getJq().isArray(a[s]))for(var o=0;o<a[s].length;++o)t(s,n(s,a[s][o])),_SgmntfY_._getDataLayer()[s][o].__processed__=!0;else t(s,n(s,a[s])),_SgmntfY_._getDataLayer()[s].__processed__=!0}e.length>0&&_SgmntfY_._sendRequestToServer(e)}},_getNextPageQueue:function(){try{var e=_SgmntfY_._variables.storage.nextPageQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read next page queue: "+e)}return[]},_setNextPageQueue:function(e){var t=_SgmntfY_._variables.storage.nextPageQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToNextPageQueue:function(e){var t=_SgmntfY_._getNextPageQueue();t.push(e),_SgmntfY_._setNextPageQueue(t)},_consumeNextPageQueue:function(){var e=_SgmntfY_._getNextPageQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.hasOwnProperty("data")||(n=_SgmntfY_._prepareRequest(n.params,n.eventName,!0)),n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setNextPageQueue([])}},_addRecommendedProduct:function(e){_SgmntfY_._variables.recommendedProducts.push(e)},_containsRecommendedProduct:function(e){return _SgmntfY_._variables.recommendedProducts.indexOf(e)>=0},_addRecommendedPromotion:function(e){_SgmntfY_._variables.recommendedPromotions.push(e)},_containsRecommendedPromotion:function(e){return _SgmntfY_._variables.recommendedPromotions.indexOf(e)>=0},_getExtensionStatus:function(e){try{var t;return t="qa"===e?_SgmntfY_._variables.storage.qaExtensionStatus:"searchBeta"===e?_SgmntfY_._variables.storage.searchBetaExtensionStatus:_SgmntfY_._variables.storage.extensionStatus,_SgmntfY_._getPersistentData(t.key,t.local)||""}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read extension status: "+e)}return""},_getDelayedCampaigns:function(){try{var e=_SgmntfY_._variables.storage.delayedCampaigns;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed campaigns: "+e)}return[]},_setDelayedCampaigns:function(e){var t=_SgmntfY_._variables.storage.delayedCampaigns;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;++n)if(t[n].campaign.instanceId===e.campaign.instanceId)return!1;var a=new Date;if(e.time.getTime()<a.getTime())return!1;var r=e.campaign,i=e.request,s=_SgmntfY_._campaigns[r.type];return setTimeout(function(){for(var t=_SgmntfY_._getDelayedCampaigns(),n=!1,a=0;a<t.length;++a)t[a].campaign.instanceId===e.campaign.instanceId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r.type+") triggered after delay"),s.call(null,r,i),_SgmntfY_._removeDelayedCampaign(r.instanceId))},e.time.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedCampaigns(t),!0},_removeDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;n++)if(t[n].campaign.instanceId===e)return t.splice(n,1),void _SgmntfY_._setDelayedCampaigns(t)},_interaction:function(e,t,n){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:e,instanceId:t,interactionId:n})},_getFireTime:function(e){function t(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n}try{return e.getFullYear()+"."+t(e.getMonth()+1,2)+"."+t(e.getDate(),2)+" "+t(e.getHours(),2)+":"+t(e.getMinutes(),2)+":"+t(e.getSeconds(),2)+"."+t(e.getMilliseconds(),3)}catch(e){return""}},_getTimeZone:function(e){try{return e.getTimezoneOffset().toString()}catch(e){return""}},_getJq:function(){return _SgmntfY_._variables.jq},_getMustache:function(){return _SgmntfY_._variables.mustache},_getObjectByString:function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),a=0,r=n.length;a<r;++a){var i=n[a];if(!(i in e))return;e=e[i]}return e},_isUndefined:function(e){return void 0===e},_notNull:function(e){return void 0!==e&&null!=e},_isEmpty:function(e){return void 0===e||null==e||""===e},_isNotEmpty:function(e){return!_SgmntfY_._isEmpty(e)},_isPlainObject:function(e){if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"==Object.prototype.toString.call(e)}return!1},_isElemVisible:function(e){try{if(_SgmntfY_._exists(e)&&"none"!==e.css("display")){var t=_SgmntfY_._getJq()(window),n=t.scrollTop(),a=n+t.height();e instanceof HTMLElement?e=_SgmntfY_._getJq()(e):e instanceof HTMLCollection&&(e=_SgmntfY_._getJq()(e[0]));var r=e.offset().top;return r+100<=a&&r>=n}return!1}catch(e){return!1}},_exists:function(e){return e instanceof HTMLElement?null!==e:(e instanceof HTMLCollection||e instanceof _SgmntfY_._getJq()||e instanceof jQuery||e instanceof $)&&e.length>0},_extend:function(){var e,t,n,a,r,i=arguments[0]||{},s=1,o=arguments.length,_=!1;for("boolean"==typeof i&&(_=i,i=arguments[s]||{},s++);s<o;s++)if(null!=(e=arguments[s]))for(t in e)if(e.hasOwnProperty(t)){if(n=i[t],i===(a=e[t]))continue;_&&a&&_SgmntfY_._isPlainObject(a)?(r=n&&"object"==typeof n&&null!==n?n:{},i[t]=_SgmntfY_._extend(_,r,a)):void 0!==a&&(i[t]=a)}return i},_split:function(e,t,n){if(e&&"string"==typeof e){var a,r=e.split(t);for(a=0;a<r.length;a++)r[a]=r[a].trim();if(n&&n<r.length){var i=r.splice(0,n-1);i.push(r.join(t)),r=i}return r}return null},_parseFloat:function(e){return null==e?e:void 0===e?null:"number"==typeof e?e:"string"==typeof e?parseFloat(e):e},_parseBoolean:function(e){return void 0===e?null:"number"==typeof e?0===e?"false":"true":"string"==typeof e?"0"===e||"false"===e.toLowerCase()?"false":"true":"boolean"==typeof e?e.toString():e},_null:function(e){return null!=e&&""!=e},_clearNullByte:function(e){return e.replace(/\0/g,"")},_checkVersion:function(e,t){var n=t.split("."),a=e.split(".");prevs=[];for(var r=0,i=Math.max(n.length,a.length);r<i;r++){if(n[r]=parseInt(n[r]),isNaN(n[r])&&(n[r]=0),a[r]=parseInt(a[r]),isNaN(a[r])&&(a[r]=0),n[r]<a[r])return!1;if(n[r]>a[r])return!0}return!0},_updateBrowserAndDeviceInfo:function(){if(void 0!==window.bowser){var e=window.bowser._detect(_SgmntfY_._variables.ua.agentString);null==_SgmntfY_._variables.ua.type&&(e.tablet?_SgmntfY_._variables.ua.type="tablet":e.mobile?_SgmntfY_._variables.ua.type="mobile":_SgmntfY_._variables.ua.type="PC",e.chromium?_SgmntfY_._variables.ua.name="Chrome":_SgmntfY_._variables.ua.name=e.name,_SgmntfY_._variables.ua.version=e.version),null==_SgmntfY_._variables.ua.os&&(_SgmntfY_._variables.ua.os=e.osname||"Other",_SgmntfY_._variables.ua.osversion=e.osversion)}},_addLeavePageHandler:function(e,t){var n=e.type,a=e.params,r=_SgmntfY_._actions[n];_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered when user leaves page");var i=function(e){e.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",i),r.call(null,a,t))};_SgmntfY_._getJq()(document).bind("mouseleave",i)},_addWaitPageHandler:function(e,t){var n=e.type,a=e.params,r=e.delayAction||null,i=_SgmntfY_._actions[n],s=parseInt(r.time);_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered after "+s+" second(s) delay on same page"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered after delay"),i.call(null,a,t)},1e3*s)},_addScrollHandler:function(e,t){var n=e.type,a=e.delayAction,r=parseInt(a.time)||0;_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._actions[n].call(null,e.params,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignDelayHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+" second(s) delay on same page"),window.setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+" delay"),_SgmntfY_._campaigns[n].call(null,e,t)},1e3*r)},_addCampaignDelayAllPagesHandler:function(e,t){var n=e.timing||"0",a={campaign:e,request:t,time:new Date((new Date).getTime()+1e3*parseInt(n.param))};_SgmntfY_._addDelayedCampaign(a)?_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") added for delayed campaign in future"):_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") already added for delayed campaign")},_addCampaignScrollHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignLeaveHandler:function(e,t){var n=e.type;_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered when user leaves page");var a=function(r){r.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",a),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("mouseleave",a)},_addCampaignInteractionHandler:function(e,t){},_getScrollPercent:function(){var e=document.documentElement,t=document.body,n="scrollTop",a="scrollHeight";return(e[n]||t[n])/((e[a]||t[a])-e.clientHeight)*100},_updateUserAndSessionId:function(e){_SgmntfY_._variables.waitingKeys=!0;var t={data:null,url:_SgmntfY_._getEventUrl()+"/get/key/v1.json?count="+e};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"GET",url:t.url,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a),2===e&&_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,n[1],390,_SgmntfY_._variables.storage.user.local);var i=_SgmntfY_._getUserId();_SgmntfY_._isEmpty(i)?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Id"):(_SgmntfY_.LOG_MESSAGE("INFO","User Id Changed: "+i),_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,n[0],0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Session"):(_SgmntfY_.LOG_MESSAGE("INFO","User Session Changed: "+n[0]),_SgmntfY_._variables.waitingKeys=!1,_SgmntfY_._variables.keysTryCount++))}).fail(function(e,n,a){_SgmntfY_._ajaxError(t,e,n,a),_SgmntfY_._variables.keysTryCount++,_SgmntfY_._variables.waitingKeys=!1})},_sendRequestToServer:function(e){if(e&&!(e.length<=0)){for(var t=[],n=0;n<e.length;n++)t.push(e[n].data);var a={"X-Sfy-Api-Key":_SgmntfY_._variables.apiKey};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"POST",url:_SgmntfY_._getEventUrl()+"/add/events/v1.json?apiKey="+_SgmntfY_._variables.apiKey,data:JSON.stringify(t),headers:a,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a);var i=n.statusCode||"";if("SUCCESS"===i){var s=n.responses,o=n.campaigns,_=n.search,c=n.coupons||[[]];if(s.length===e.length&&o.length===e.length)for(var g=0;g<s.length;g++){var m=e[g],l=s[g],d=o[g],f=_[g],u=c[g];"true"!==m.originalParams.discardResponse?(_SgmntfY_._getResponse(m,l),_SgmntfY_._getCampaign(m,d),_SgmntfY_._getSearchCampaign(m,f),_SgmntfY_.initCoupon(u)):_SgmntfY_.LOG_MESSAGE("DEBUG","Action("+m.eventName+") responses are discarded")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response length("+s.length+") doesn't match request length("+e.length+")")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response is ("+i+")"),"NO_SESSIONID"===i?_SgmntfY_._updateUserAndSessionId(1):"NO_USERID"===i&&_SgmntfY_._updateUserAndSessionId(2)}).fail(function(n,a,r){for(var i=!1,s=0;s<e.length;s++)_SgmntfY_._jbOverFlowOperations._journeyFinished(e[s])&&(i=!0);if(i&&_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1),0!==_SgmntfY_._getJq()(".seg-search-wrapper").length)if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var o=null;e&&e.length>0&&(o=e.filter(function(e){return"SEARCH"===e.eventName})),o&&o.length>0&&_SgmntfY_._variables.search.initialCampaign?_SgmntfY_._getSearchCampaign(o[0],[{campaign:_SgmntfY_._variables.search.initialCampaign}]):_SgmntfY_._getJq().each(_SgmntfY_._getJq()(_SgmntfY_._variables.search.input),function(){"matrix(1, 0, 0, 1, 0, -2000)"==_SgmntfY_._getJq()(this).css("transform")&&(_SgmntfY_._getJq()(this).addClass("seg-search-unset"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),_SgmntfY_._getJq()(this).blur())})}else(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("open")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-open"))&&(_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"));_SgmntfY_._addToRetryQueue(e),_SgmntfY_._ajaxError(t,n,a,r)})}},_getResponse:function(e,t){_SgmntfY_._jbCheckDeliveryStep(e,t);for(var n=0;n<t.length;n++){var a=t[n];if(a.hasOwnProperty("type")){var r=a.type,i=a.delayAction||null,s=a.params,o=(a.instanceId,_SgmntfY_._actions[r]);if(!1===s.isControlGroup){_SgmntfY_.LOG_MESSAGE("DEBUG","User is in control group for campaign: "+s.instanceId);continue}if("function"==typeof o)if(i&&"LEAVE_PAGE"===i.type)_SgmntfY_._addLeavePageHandler(a,e);else if(i&&"WAIT_SAME_PAGE"===i.type&&parseInt(i.time)>0)_SgmntfY_._addWaitPageHandler(a,e);else if(i&&"WAIT_ALL_PAGES"===i.type&&parseInt(i.time)>0){var _={delayDate:new Date((new Date).getTime()+1e3*parseInt(i.time)),params:s,type:r,request:e};_SgmntfY_._addDelayedAction(_)?_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+_.params.actionId+") is added for delayed action in future"):_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+_.params.actionId+") is already added for delayed action")}else i&&"SCROLL"===i.type?_SgmntfY_._addScrollHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") triggered immediately"),o.call(null,s,e));else _SgmntfY_.LOG_MESSAGE("WARN","Unknown action: "+r)}}},_jbCheckDeliveryStep:function(e,t){if(_SgmntfY_._jbOverFlowOperations._journeyFinished(e)){for(var n=!1,a=!1,r=0;r<t.length;r++){var i=t[r],s=i.type;"recommendProducts"===s&&Object.keys(i.params.recommendedProducts)&&Object.keys(i.params.recommendedProducts).forEach(function(e){i.params.recommendedProducts[e]&&i.params.recommendedProducts[e].length>0&&(n=!0)}),"giveCoupon"===s&&(a=!0)}!0===n||!0===a?_SgmntfY_._jbOnDestroyJourneyFlowExecution(!0):_SgmntfY_._jbOnDestroyJourneyFlowExecution(!1)}},_getCampaign:function(e,t){for(var n=0;n<t.length;n++){var a=t[n]||{};if(a.hasOwnProperty("type")){var r=a.type,i=_SgmntfY_._campaigns[r];if("function"==typeof i){var s=a.timing||{};"DELAY"===s.type?_SgmntfY_._addCampaignDelayHandler(a,e):"DELAY_ALL_PAGES"===s.type?_SgmntfY_._addCampaignDelayAllPagesHandler(a,e):"SCROLL"===s.type?_SgmntfY_._addCampaignScrollHandler(a,e):"PAGELEAVE"===s.type?_SgmntfY_._addCampaignLeaveHandler(a,e):"INTERACTION"===s.type?_SgmntfY_._addCampaignInteractionHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r+") triggered immediately."),i.call(null,a,e))}else _SgmntfY_.LOG_MESSAGE("WARN","Unknown campaign: "+r)}}},initCoupon:function(e){try{if(0===e.length)return;var t=_SgmntfY_._getJq()(document).find("#seg-coupon-asimov");if(t&&t.length>0)return;var n=e[0],a=n.widget.html,r=n.widget.validationText,i={code:n.code,valid_until:r+" "+new Date(n.validUntil).toLocaleDateString(),copy_button_text:n.widget.copyButtonText,description:n.widget.description,title:n.widget.title},s=_SgmntfY_._getMustache().render(a,i),o=(s=_SgmntfY_._getJq()(s)).first(),_=s.find(".seg-coupon-asimov_content"),c=s.find(".seg-coupon-asimov_switch");"RIGHT"===n.widget.position&&o.addClass("seg-coupon-asimov_right"),_.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),c.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),_SgmntfY_._getJq()("body").prepend(s),_SgmntfY_.bindCouponBindings({copiedInfoText:n.widget.copiedInfoText}),_SgmntfY_._openCoupon(),setTimeout(function(){_SgmntfY_._closeCoupon()},2e3)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Coupon couldn't be rendered!")}},bindCouponBindings:function(e){try{function t(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}else setTimeout(function(){e.css("height","auto")},500);setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")}_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_switch",function(){if(_SgmntfY_._getJq()(this).parent("#seg-coupon-asimov").hasClass("no-interaction"))return!1;t()}),_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_copy:not(.no-interaction)",function(){_SgmntfY_._getJq()("#seg-coupon-asimov").addClass("no-interaction"),_SgmntfY_._getJq()(this).addClass("no-interaction"),_SgmntfY_._textCopyToClipBoard("seg-coupon-asimov_code");var n=_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html();return _SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(e.copiedInfoText),setTimeout(function(){t(),setTimeout(function(){_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(n),_SgmntfY_._getJq()("#seg-coupon-asimov").removeClass("no-interaction"),_SgmntfY_._getJq()(".seg-coupon-asimov_copy").removeClass("no-interaction")},400)},1e3),!1})}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Could not bind coupon bindings.")}},_textCopyToClipBoard:function(e){if(e=document.getElementsByClassName(e)[0],document.body.createTextRange)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t,n=window.getSelection();(t=document.createRange()).selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}else _SgmntfY_.LOG_MESSAGE("WARN","Could not select text in node: Unsupported browser.");document.execCommand("copy"),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_openCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),setTimeout(function(){e.css("height","auto")},500),setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_closeCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_decodeHtml:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},_getSearchCampaign:function(e,t){if("SEARCH"===e.eventName&&(_SgmntfY_._variables.search.isExecutable||_SgmntfY_._variables.search.isExecutableForAfter)&&0===t.length&&(t=[{campaign:_SgmntfY_._variables.search.initialCampaign}]),0!==t.length)if(!0===t[0].isExecutable||!0===t[0].isExecutableForAfter)a=t[0].initialCampaign,_SgmntfY_._variables.search.isExecutable=t[0].isExecutable,_SgmntfY_._variables.search.isExecutableForAfter=t[0].isExecutableForAfter,_SgmntfY_._variables.search.input=t[0].idOrClassName,_SgmntfY_._variables.search.manuelTrigger=t[0].manuelTrigger,_SgmntfY_._variables.search.initialCampaign=a,_SgmntfY_._variables.search.searchMinChar=a&&a.minCharacterCount||3,_SgmntfY_._variables.search.searchDelay=a&&a.searchDelay||500,_SgmntfY_._initSearch();else if(void 0===t[0].isExecutable&&void 0===t[0].isExecutableForAfter){var n=void 0;_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&(n=_SgmntfY_._variables.search.currentActiveInput.value.trim()),void 0!==e.data.query&&void 0!==_SgmntfY_._variables.search.currentActiveInput&&e.data.query!==_SgmntfY_._prepareSearchQuery(n)||_SgmntfY_._searchResultHandler(e,t)}var a},_isSearchOpen:function(){var e=_SgmntfY_._getJq()(".seg-search-wrapper");return e.hasClass("open")||e.hasClass("sgm-search-open")},_searchInputActivateHandler:function(e){if(!_SgmntfY_._getJq()(".seg-search-wrapper")||!_SgmntfY_._isSearchOpen()){if(_SgmntfY_._variables.search.currentActiveInput=e.target,0===_SgmntfY_._getJq()(".seg-search-wrapper").length)_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"}).appendTo("body");!function(){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device"));var e="undefined"!=typeof sgmSearchSettings&&sgmSearchSettings.mobileSearchAssets&&0===sgmSearchSettings.mobileSearchAssets.length;e&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("no-sidebar"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-no-sidebar")),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("mobile"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-mobile");var t=!1,n=_SgmntfY_._getJq()("meta");if(n.each(function(e){"viewport"===e.name&&(t=!0,!0===e.content.includes("width=")&&!0!==e.content.includes("width=device-width")?!0!==e.content.includes("user-scalable=")&&(e.content=e.content.concat(" ,user-scalable=no")):(!0!==e.content.includes("width=device-width")&&(e.content=e.content.concat(" ,width=device-width")),!0!==e.content.includes("initial-scale=")&&(e.content=e.content.concat(" ,initial-scale=1.0")),!0!==e.content.includes("maximum-scale=")&&(e.content=e.content.concat(" ,maximum-scale=1.0")),!0!==e.content.includes("user-scalable=")&&(e.content=e.content.concat(" ,user-scalable=no"))))}),!t){var a=document.createElement("meta");a.name="viewport",a.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(a)}}}();var t=_SgmntfY_._variables.search.currentActiveInput.value.trim().length;_SgmntfY_._variables.search.keywordSearch=t>=_SgmntfY_._variables.search.searchMinChar,_SgmntfY_._variables.search.emptySearch=0===t||t<_SgmntfY_._variables.search.searchMinChar,!0!==_SgmntfY_._variables.search.emptySearch&&!0!==_SgmntfY_._variables.search.keywordSearch||_SgmntfY_._sendSearchRequest()}},_disableSearchTriggerEventsOnSite:function(){_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).off(),_SgmntfY_._getActiveSearchManuelTrigger()&&_SgmntfY_._getJq()(_SgmntfY_._variables.search.manuelTrigger).off(),_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).attr("autocomplete","OFF")},_getActiveSearchManuelTrigger:function(){return _SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?_SgmntfY_._variables.search.manuelTrigger:_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&!0===_SgmntfY_._variables.search.manuelTriggerEnabledForDesktop?_SgmntfY_._variables.search.manuelTriggerDesktop:null},_activateSgmSearchTriggerEvents:function(){"safari"===bowser.name.toLowerCase()||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?_SgmntfY_._getJq()(document).on("click",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler):_SgmntfY_._getJq()(document).on("focus",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",_SgmntfY_._searchInputActivateHandler)},_initSearch:function(){_SgmntfY_._disableSearchTriggerEventsOnSite(),_SgmntfY_._activateSgmSearchTriggerEvents(),_SgmntfY_._getJq().each(_SgmntfY_._getJq()(_SgmntfY_._variables.search.input),function(e){if(this===document.activeElement)return _SgmntfY_._variables.search.currentActiveInput=e.target,!1}),_SgmntfY_._getJq()(document).on("input",_SgmntfY_._variables.search.input+", #sgm-mobile-input input",function(e){_SgmntfY_._variables.search.currentActiveInput=e.target;var t=_SgmntfY_._variables.search.currentActiveInput.value;_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).not("#sgm-mobile-input input").val(t),_SgmntfY_._variables.search.keywordSearch=t.length>=_SgmntfY_._variables.search.searchMinChar,_SgmntfY_._variables.search.emptySearch=0===t.length||t.length<_SgmntfY_._variables.search.searchMinChar,(!0===_SgmntfY_._variables.search.emptySearch||!0===_SgmntfY_._variables.search.keywordSearch)&&_SgmntfY_._sendSearchRequest()}),_SgmntfY_._getJq()(document).on("blur","#sgm-mobile-input input",function(){_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-keyboard-on"),_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).removeAttr("readonly")}),_SgmntfY_._getActiveSearchManuelTrigger()&&_SgmntfY_._getJq()(document).on("click",_SgmntfY_._getActiveSearchManuelTrigger(),function(){if(0===_SgmntfY_._getJq()(".seg-search-wrapper").length){var e=_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"});e.appendTo("body")}_SgmntfY_._variables.search.emptySearch=!0,_SgmntfY_._variables.search.keywordSearch=!1,_SgmntfY_._sendSearchRequest(!0)}),_SgmntfY_._evalSearchBodyScrollLockPreJs()},_sendSearchRequest:function(e){var t="";_SgmntfY_._variables.search.manuelTriggerClicked=!1,e?_SgmntfY_._variables.search.manuelTriggerClicked=!0:t=_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&_SgmntfY_._variables.search.currentActiveInput.value.trim();try{_SgmntfY_._variables.search.searchTimer&&clearTimeout(_SgmntfY_._variables.search.searchTimer)}catch(e){}_SgmntfY_._variables.search.searchTimer=setTimeout(function(){!0===_SgmntfY_._variables.search.emptySearch&&_SgmntfY_._variables.segmentifyObj("search",{query:""});!0===_SgmntfY_._variables.search.keywordSearch&&t.length>=_SgmntfY_._variables.search.searchMinChar&&_SgmntfY_._variables.segmentifyObj("search",{query:_SgmntfY_._prepareSearchQuery(t)})},_SgmntfY_._variables.search.searchDelay)},_triggerSearch:function(e){if(!0===_SgmntfY_._variables.search.isExecutable||!0===_SgmntfY_._variables.search.isExecutableForAfter){var t=e&&e.searchText;if(!t)return void _SgmntfY_.LOG_MESSAGE("WARN","searchText is mandatory field to trigger search");var n={delay:0,isManuelTriggered:!1,inputSelector:_SgmntfY_._variables.search.input,manuelTrigger:_SgmntfY_._getActiveSearchManuelTrigger()},a=_SgmntfY_._getCopiedObject(n,e);setTimeout(function(){var e=_SgmntfY_._getJq()(a.inputSelector);e&&e.length>0&&(_SgmntfY_._variables.search.currentActiveInput=e[0],_SgmntfY_._variables.search.currentActiveInput.value=t,_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).click(),_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).focus(),!0===a.isManuelTriggered&&a.manuelTrigger?_SgmntfY_._getJq()(a.manuelTrigger).click():_SgmntfY_._sendSearchRequest())},a.delay)}else _SgmntfY_.LOG_MESSAGE("WARN","search is not executable to trigger search")},_prepareSearchQuery:function(e){return e},_searchResultHandler:function(request,searchResult){var searchArray=searchResult[0],campaign=searchArray.campaign,products=searchArray.products||[],brands=searchArray.brands||{},brandProducts=searchArray.brandProducts||{},categories=searchArray.categories||{},categoryProducts=searchArray.categoryProducts||{},keywords=searchArray.keywords||{};if(null!=campaign){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:"static",instanceId:campaign.instanceId}),null!==products&&products.length>0&&_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:"static",instanceId:campaign.instanceId}),_SgmntfY_._variables.search.emptySearch="BEFORE_SEARCH"===campaign.instanceId,_SgmntfY_._variables.search.keywordSearch="SEARCH"===campaign.instanceId,sgmSearchSettings={data:{},mobileInput:"#sgm-mobile-input",searchResultsEl:".seg-search-wrapper",incremental:searchArray.incremental,searchUrlPrefix:campaign.searchUrlPrefix,instanceId:campaign.instanceId,html:campaign.html,postJs:campaign.postJs,preJs:campaign.preJs,css:campaign.css,openingDirection:campaign.openingDirection,input:campaign.searchInputSelector,currentSearchBoxEl:campaign.hideCurrentSelector,searchAssets:campaign.searchAssets||[],mobileSearchAssets:campaign.mobileSearchAssets||[],searchAssetsTexts:campaign.stringSearchAssetTextMap||[],categoryTreeView:!1,manuelTrigger:campaign.triggerSelector,sgmSearchShowAll:!1,resultsTopMargin:{mobile:0,desktop:0},isSidebarItemsClickable:{categories:!1,brands:!1,keywords:!1},highlightEnabled:{categories:!1,brands:!1,keywords:!1},itemLimits:{howManyBrand:0,howManyCategory:0,howManyKeyword:0,howManyDesktopProduct:campaign.desktopItemCount,howManyMobileProduct:campaign.mobileItemCount},itemEnable:{category:!1,brand:!1,keyword:!1},sidebar:{mobile:!1,desktop:!0},texts:{categories:"",popularCategories:"",brands:"",popularBrands:"",keywords:"",products:"",showAll:"Show All",currency:"",notFound:"",cancelText:""}},_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth&&0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")),0===_SgmntfY_._getJq()("#sgm_current_search_box").length&&_SgmntfY_._getJq()("head").append('<style id="sgm_current_search_box">'+sgmSearchSettings.currentSearchBoxEl+" { display: none!important; position: absolute!important; left: -999999px!important; top: -99999999px!important; visibility: hidden!important; opacity: 0!important }</style>"),_SgmntfY_._variables.search.searchDelay=campaign.searchDelay>50?campaign.searchDelay:50,_SgmntfY_._variables.search.searchMinChar=campaign.minCharacterCount,sgmSearchSettings.texts.showAll=_SgmntfY_._variables.search.showAll;var searchAssetElements=_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?sgmSearchSettings.mobileSearchAssets:sgmSearchSettings.searchAssets;_SgmntfY_._getJq().each(searchAssetElements,function(e,t){"CATEGORY"===t.type?(sgmSearchSettings.categoryTreeView=t.categoryTreeView,sgmSearchSettings.isSidebarItemsClickable.categories=t.clickable,sgmSearchSettings.itemLimits.howManyCategory=t.itemCount,sgmSearchSettings.itemEnable.category=!0,sgmSearchSettings.highlightEnabled.categories=t.highlight):"BRAND"===t.type?(sgmSearchSettings.isSidebarItemsClickable.brands=t.clickable,sgmSearchSettings.itemLimits.howManyBrand=t.itemCount,sgmSearchSettings.itemEnable.brand=!0,sgmSearchSettings.highlightEnabled.brands=t.highlight):"KEYWORD"===t.type&&(sgmSearchSettings.isSidebarItemsClickable.keywords=t.clickable,sgmSearchSettings.itemLimits.howManyKeyword=t.itemCount,sgmSearchSettings.itemEnable.keyword=!0,sgmSearchSettings.highlightEnabled.keywords=t.highlight)});var currentDeviceIsPC="PC"===(_SgmntfY_._variables.ua.type||"PC").toUpperCase();_SgmntfY_._getJq().each(sgmSearchSettings.searchAssetsTexts,function(e,t){e===request.data.lang&&(sgmSearchSettings.texts.categories=t.categoriesText,sgmSearchSettings.texts.popularCategories=currentDeviceIsPC?t.popularCategoriesText:t.mobilePopularCategoriesText,sgmSearchSettings.texts.brands=t.brandsText,sgmSearchSettings.texts.popularBrands=currentDeviceIsPC?t.popularBrandsText:t.mobilePopularBrandsText,sgmSearchSettings.texts.popularProducts=t.popularProductsText,sgmSearchSettings.texts.products=t.popularProductsText,sgmSearchSettings.texts.keywords=currentDeviceIsPC?t.popularKeywordsText:t.mobilePopularKeywordsText,sgmSearchSettings.texts.cancelText=t.mobileCancelText,sgmSearchSettings.texts.notFound=t.notFoundText)}),sgmSearchSettings.data.categories=_SgmntfY_._getArrayOfMap(categories),sgmSearchSettings.data.brands=_SgmntfY_._getArrayOfMap(brands),sgmSearchSettings.data.keywords=_SgmntfY_._getArrayOfKeywordsMap(keywords),sgmSearchSettings.data.products=_SgmntfY_._getArrayOfProductMap(products),sgmSearchSettings.data.keywordsProducts=keywords,sgmSearchSettings.data.categoryProducts=categoryProducts,sgmSearchSettings.data.brandProducts=brandProducts,sgmSearchSettings.data.itemEnable=sgmSearchSettings.itemEnable,sgmSearchSettings.data.texts=sgmSearchSettings.texts,sgmSearchSettings.data.synonyms=searchArray.synonyms;try{if(sgmSearchSettings.preJs){eval(sgmSearchSettings.preJs);var retVal=preRenderConf(sgmSearchSettings);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product search pre js code: "+e)}_SgmntfY_._populateSearchResults(sgmSearchSettings.data,null,!0),_SgmntfY_._getJq()(document).on("submit",sgmSearchSettings.searchResultsEl+" form",function(e){e.preventDefault(),_SgmntfY_._goToSearchResultPage()}),_SgmntfY_._getJq()(document).on("click",".sgm-search-sidebar ul li",function(){var e=_SgmntfY_._getJq()(this).parent("ul").data("group");!0===sgmSearchSettings.isSidebarItemsClickable[e]&&((_SgmntfY_._getJq()(this).attr("data-url")||"")&&(window.location.href=_SgmntfY_._getJq()(this).attr("data-url"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-open")))}),_SgmntfY_._getJq()(document).on("mouseover",".sgm-search-sidebar li",function(){if(_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&_SgmntfY_._decodeHtml(_SgmntfY_._getJq()(".sgm-search-products-title").html())!==_SgmntfY_._getJq()(this).text()){var e=_SgmntfY_._getJq()(this).parent("ul").data("group");_SgmntfY_._getJq()(".sgm-search-sidebar li.selected").removeClass("selected"),_SgmntfY_._getJq()(".sgm-search-sidebar li.sgm-search-selected").removeClass("sgm-search-selected"),_SgmntfY_._getJq()(this).addClass("selected"),_SgmntfY_._getJq()(this).addClass("sgm-search-selected");var t=_SgmntfY_._getJq()(this).data("original"),n=[];"keywords"===e?n=sgmSearchSettings.data.keywordsProducts:"categories"===e?n=sgmSearchSettings.data.categoryProducts:"brands"===e&&(n=sgmSearchSettings.data.brandProducts),_SgmntfY_._getJq().each(n,function(e,n){if(e===t){var a=[];a.products=_SgmntfY_._getArrayOfProductMap(n),_SgmntfY_._populateSearchResults(a,"products")}}),_SgmntfY_._getJq()(".sgm-search-products-title").html(_SgmntfY_._getJq()(this).text())}}),_SgmntfY_._getJq()(window).on("load resize scroll orientationchange",onChangeWindowOrOrientation),_SgmntfY_._getJq()(document).on("click","#sgm-mobile-input-cancel",_SgmntfY_.mobileSearchCancel),_SgmntfY_._getJq()(document).on("click",".sgm-search-show-all",function(e){document.location=sgmSearchSettings.searchUrlPrefix+_SgmntfY_._variables.search.currentActiveInput.value.trim()}),_SgmntfY_._getJq()(document).on("click","*",onCloseSearchResult),_SgmntfY_._getJq()(".sgm-search-wrapper").addClass("seg-infinit-z-index")}function onChangeWindowOrOrientation(e){_SgmntfY_._setSearchResultsPosition(),_SgmntfY_._openSearchResults(),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device"))}function onCloseSearchResult(e){try{if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("open")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-open")){var t=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl),n=_SgmntfY_._getJq()(sgmSearchSettings.input);if(!t.is(e.target)&&0===t.has(e.target).length&&!_SgmntfY_._getJq()(n).is(document.activeElement)||"sgm-mobile-input-cancel"===_SgmntfY_._getJq()(e.target).attr("id")){var a=document.querySelector(sgmSearchSettings.searchResultsEl);bodyScrollLock.enableBodyScroll(a),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),_SgmntfY_._variables.search.manuelTriggerClicked=!1}}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in document click: "+e)}}},_getArrayOfMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:a},n+=1}),t},_populateSearchResults:function(e,t,n){e.emptySearch=_SgmntfY_._variables.search.emptySearch,e.keywordSearch=_SgmntfY_._variables.search.keywordSearch;var a,r,i=null,s=new DOMParser;try{i=s.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-product-template")}catch(e){return void _SgmntfY_.LOG_MESSAGE("WARN","Error in html parsing for id: sgm-search-product-template: "+e)}var o=_SgmntfY_._getCopiedObject(e);if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?o.products=e.products.slice(0,sgmSearchSettings.itemLimits.howManyMobileProduct):o.products=e.products.slice(0,sgmSearchSettings.itemLimits.howManyDesktopProduct),"products"===t)r=_SgmntfY_._getMustache().render(i.innerHTML,o),_SgmntfY_._fillSearchResults(r,"products");else{if(0===_SgmntfY_._getJq()(".sgm-search-sidebar").length)try{(a=s.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-template"))&&(a=_SgmntfY_._decodeHtml(a.innerHTML),r=_SgmntfY_._getMustache().render(a,o,{products:i.innerHTML}),_SgmntfY_._fillSearchResults(r))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in html parsing for id: sgm-search-template: "+e)}else c("sgm-search-sidebar"),c("sgm-search-header"),c("sgm-search-products");1===_SgmntfY_._getJq()(".sgm-search-sidebar").length&&(r=_SgmntfY_._getMustache().render(i.innerHTML,o),_SgmntfY_._fillSearchResults(r,"products"))}if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar").find("li").each(function(){var e=_SgmntfY_._getJq()(this).text();e=_SgmntfY_._prepareSearchAssetText(e);var t="";_SgmntfY_._variables.search.currentActiveInput&&_SgmntfY_._variables.search.currentActiveInput.value&&(t=_SgmntfY_._variables.search.currentActiveInput.value.trim());var n=this.parentElement.getAttribute("data-group"),a=sgmSearchSettings.data.synonyms||[];0===a.length&&a.push(t),_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&t&&""!==t&&("categories"===n&&sgmSearchSettings.highlightEnabled.categories?e=_SgmntfY_._highlight(a,e):"brands"===n&&sgmSearchSettings.highlightEnabled.brands?e=_SgmntfY_._highlight(a,e):"keywords"===n&&sgmSearchSettings.highlightEnabled.keywords&&(e=_SgmntfY_._highlight(a,e))),_SgmntfY_._getJq()(this).html(e)}),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){if(0===_SgmntfY_._getJq()("#sgm-mobile-input").length){_SgmntfY_._getJq()("<input type='search' name='search' autocomplete='OFF'>").insertBefore(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).children(".sgm-search-header")).wrap('<div id="sgm-mobile-input"></div>').wrap('<form action="/"></form>'),_SgmntfY_._getJq()("#sgm-mobile-input").append('<div id="sgm-mobile-input-clear"></div><div id="sgm-mobile-input-cancel">'+sgmSearchSettings.texts.cancelText+"</div>");var _=_SgmntfY_._getJq()("#sgm-mobile-input input");_&&_.length>0&&(_SgmntfY_._variables.search.currentActiveInput||(_SgmntfY_._variables.search.currentActiveInput=_[0]),setTimeout(function(){_.val(_SgmntfY_._variables.search.currentActiveInput.value).focus(),_SgmntfY_._variables.search.currentActiveInput=_[0],_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).not("#sgm-mobile-input input").attr("readonly","readonly")},10))}}function c(e){try{var t=s.parseFromString(sgmSearchSettings.html,"text/html").getElementsByClassName(e)[0];t&&(t=_SgmntfY_._decodeHtml(t.innerHTML),r=_SgmntfY_._getMustache().render(t,o,{products:i.innerHTML}),_SgmntfY_._fillSearchResults(r,e))}catch(t){_SgmntfY_.LOG_MESSAGE("WARN","Error in parsing html for  "+e+" in search "+t)}}!0===n&&_SgmntfY_._openSearchResults(!0)},_prepareSearchAssetText:function(e){return e=!1===sgmSearchSettings.categoryTreeView?(e=e.replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language).split("/"))[e.length-1]:e.replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language),e=e.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" ")},mobileSearchCancel:function(){var e=document.querySelector(".seg-search-wrapper");return bodyScrollLock.enableBodyScroll(e),_SgmntfY_._getJq()("body, .wrapper-1").removeClass("noscroll"),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).val(""),_SgmntfY_._variables.search.manuelTriggerClicked=!1,!1},_goToSearchResultPage:function(){return _SgmntfY_._variables.search.currentActiveInput.value.trim().length>0&&(window.location.href=sgmSearchSettings.searchUrlPrefix+encodeURIComponent(_SgmntfY_._variables.search.currentActiveInput.value.trim())),!1},_highlight:function(e,t){return e.forEach(function(e){var n=e.toLocaleLowerCase(_SgmntfY_._variables.language),a=new RegExp(n,"ig");t=t.replace(a,"<span class='sgm-search-keyword-highlight'>$&</span>")}),t},_openSearchResults:function(e){_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("mobile")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-mobile"),0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-sidebar")),0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-products li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-products")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-products")),!0===sgmSearchSettings.isSidebarItemsClickable.categories&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=categories] li").addClass("sgm-cursor-pointer"),!0===sgmSearchSettings.isSidebarItemsClickable.brands&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=brands] li").addClass("sgm-cursor-pointer"),!0===sgmSearchSettings.isSidebarItemsClickable.keywords&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=keywords] li").addClass("sgm-cursor-pointer"),!1===sgmSearchSettings.sgmSearchShowAll&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-show-all"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-show-all")),!0===_SgmntfY_._variables.search.manuelTriggerClicked?(_SgmntfY_._disableBodyScrollAndAddOpen(e),_SgmntfY_._variables.search.manuelTriggerClicked=!1):_SgmntfY_._getJq().each(_SgmntfY_._getJq()(sgmSearchSettings.input),function(){if(_SgmntfY_._getJq()(this).is(":focus"))return _SgmntfY_._disableBodyScrollAndAddOpen(e),!1})},_disableBodyScrollAndAddOpen:function(e){if(_SgmntfY_._setSearchResultsPosition(),e&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-open"),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth)){var t=document.querySelector(".seg-search-wrapper");t&&bodyScrollLock.disableBodyScroll(t),0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar"))}},_setSearchProductCategory:function(e,t){if(t.category&&t.category.length>0){if(!1===sgmSearchSettings.categoryTreeView){var n=t.category[0].replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language);n=(n=n.split("/"))[n.length-1],e.category=n}else e.category=t.category[0].replace(/>/g,"/").toLocaleLowerCase(_SgmntfY_._variables.language);e["categories-original"]=t.category[0],!0===sgmSearchSettings.incremental&&(e["categories-original"]=[],_SgmntfY_._getJq().each(t.category,function(t,n){e["categories-original"].push(n)}))}},_getArrayOfProductMap:function(e){var t=[];return Array.isArray(e)&&e.forEach(function(e){var n={};_SgmntfY_._getJq().extend(n,e),n.name=_SgmntfY_._decodeHtml(e.name),_SgmntfY_._setSearchProductCategory(n,e),n.brand&&(n.brand=e.brand.toLocaleLowerCase(_SgmntfY_._variables.language),n["brands-original"]=e.brand);t.push(n)}),t},_getArrayOfKeywordsMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:sgmSearchSettings.searchUrlPrefix+e},n+=1}),t},_fillSearchResults:function(renderedHtml,type){try{0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(renderedHtml):"products"===type?_SgmntfY_._getJq()(".sgm-search-products ul").html(renderedHtml):0===_SgmntfY_._getJq()(".sgm-search-sidebar").length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(renderedHtml):"sgm-search-sidebar"===type?_SgmntfY_._getJq()(".sgm-search-sidebar").html(renderedHtml):"sgm-search-header"===type?_SgmntfY_._getJq()(".sgm-search-header").html(renderedHtml):"sgm-search-products"===type&&_SgmntfY_._getJq()(".sgm-search-products").html(renderedHtml);var sgmSearchStyleId="sgmStyle"+sgmSearchSettings.instanceId;null===document.getElementById(sgmSearchStyleId)&&sgmSearchSettings.css&&_SgmntfY_._getJq()('<style id="'+sgmSearchStyleId+'" />').html(sgmSearchSettings.css).prependTo(_SgmntfY_._getJq()("body"))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+type+"] with product recommendations: "+e)}try{sgmSearchSettings.postJs&&eval(sgmSearchSettings.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product SEARCH post js code: "+e)}},_setSearchResultsPosition:function(){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var e=.01*_SgmntfY_._getJq()(window).innerHeight();document.documentElement.style.setProperty("--vh",e+"px"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")}else{_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device");try{clearInterval(searchBoxInterval),clearTimeout(searchBoxTimeOut)}catch(e){}_SgmntfY_._setSearchPositionInterval(),searchBoxInterval=setInterval(_SgmntfY_._setSearchPositionInterval,10),searchBoxTimeOut=setTimeout(function(){clearInterval(searchBoxInterval)},3e3)}},_setSearchPositionInterval:function(){if(!(_SgmntfY_._getJq()(window).width()>_SgmntfY_._variables.search.maxMobileWidth&&(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("no-products")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-no-products")))){var e=sgmSearchSettings.openingDirection.toLowerCase(),t=!1,n=!1;if(_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).parents().not("body").not("html").each(function(){return"fixed"===_SgmntfY_._getJq()(this).css("position")?(t=!0,!1):"none"===_SgmntfY_._getJq()(this).css("display")?(n=!0,_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),!1):void 0}),!1===n){!0===t?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-fixed")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-absolute"));var a=_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).offset(),r={top:"",left:""};if(void 0===a)return;if(a.top!==r.top){var i=_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).outerHeight();if(!0===t)var s=a.top-_SgmntfY_._getJq()(window).scrollTop()+i+1;else s=a.top+i+1;_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("top",s),r.top=a.top}if(a.left!==r.left){var o=_SgmntfY_._getJq()(window).width(),_=_SgmntfY_._getJq()(_SgmntfY_._variables.search.currentActiveInput).parent().outerWidth(),c=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).outerWidth(),g={right:a.left,center:a.left-c/2+_/2,left:a.left+_-c};"right"===e?g[e]+c>=o&&(g[e]=g.center):"left"===e&&g[e]<=0&&(g[e]=g.center),g[e]===g.center&&(g.center<=0||g.center+c>=o)&&(g[e]=o/2-c/2),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("left",g[e])}r=a}}},_evalSearchBodyScrollLockPreJs:function(){var e;(function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0});var n=!1;if("undefined"!=typeof window){var a={get passive(){n=!0}};window.addEventListener("testPassive",null,a),window.removeEventListener("testPassive",null,a)}var r="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),i=[],s=!1,o=-1,_=void 0,c=void 0,g=void 0,m=function(e){return i.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},l=function(e){var t=e||window.event;return!!m(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)},d=function(){setTimeout(function(){void 0!==g&&(document.body.style.paddingRight=g,g=void 0),void 0!==_&&(document.body.style.overflow=_,_=void 0),void 0!==c&&(_SgmntfY_._getJq()("html").css("overflow",c),c=void 0)})};e.disableBodyScroll=function(e,a){if(r){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(e&&!i.some(function(t){return t.targetElement===e})){var d={targetElement:e,options:a||{}};i=[].concat(t(i),[d]),e.ontouchstart=function(e){1===e.targetTouches.length&&(o=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-o;!m(e.target)&&(t&&0===t.scrollTop&&n>0?l(e):function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?l(e):e.stopPropagation())}(t,e)},s||(document.addEventListener("touchmove",l,n?{passive:!1}:void 0),s=!0)}}else{!function(e){setTimeout(function(){if(void 0===g){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(g=document.body.style.paddingRight,document.body.style.paddingRight=n+"px")}void 0===_&&(_=document.body.style.overflow,document.body.style.cssText="overflow:hidden !important",_SgmntfY_._getJq()("html").css("overflow","hidden !important")),void 0===c&&(c=_SgmntfY_._getJq()("html").css("overflow"),_SgmntfY_._getJq()("html").css("overflow","hidden"))})}(a);var f={targetElement:e,options:a||{}};i=[].concat(t(i),[f])}},e.clearAllBodyScrollLocks=function(){r?(i.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),s&&(document.removeEventListener("touchmove",l,n?{passive:!1}:void 0),s=!1),i=[],o=-1):(d(),i=[])},e.enableBodyScroll=function(e){if(r){if(!e)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");e.ontouchstart=null,e.ontouchmove=null,i=i.filter(function(t){return t.targetElement!==e}),s&&0===i.length&&(document.removeEventListener("touchmove",l,n?{passive:!1}:void 0),s=!1)}else(i=i.filter(function(t){return t.targetElement!==e})).length||d()}})(e={}),window.bodyScrollLock=e},_getCopiedObject:function(){for(var e=Object(),t=0;t<arguments.length;t++)"function"==typeof Object.assign?Object.assign(e,arguments[t]):_SgmntfY_._getJq().extend(e,arguments[t]);return e},_pushInitPermissionCampaign:function(e,t){if(t.safariEnabled&&"Safari"===_SgmntfY_._variables.pushInfo.agent){if("GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&"DENIED"!==_SgmntfY_._variables.pushInfo.subscription){!function(n){if("denied"===n.permission){if("DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase());_SgmntfY_._variables.pushInfo.promptInteraction="denied"}else"granted"===n.permission?(_SgmntfY_._pushSendSafariSubscription(n,!0),_SgmntfY_._variables.pushInfo.promptInteraction="granted"):(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!1,!1),_SgmntfY_._variables.pushInfo.safariEnabled=t.safariEnabled)}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))}}else{var n="Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod,a=_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod,r=_SgmntfY_._pushShouldShowPopUp();_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(i){i?"GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&i.unsubscribe().then(function(e){e&&_SgmntfY_._pushRequestPermissionFunc(n,a,!0)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while unsubscribing user: "+e)}):_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(i){if("denied"===i||"DENIED"===i){if(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission request denied!"),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())}else"granted"===i||"GRANTED"===i?(_SgmntfY_._variables.pushInfo.promptInteraction="granted","GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._pushRequestPermissionFunc(n,a,!0)):"prompt"!==i&&"PROMPT"!==i||(_SgmntfY_._variables.pushInfo.promptInteraction="prompt",r?(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0,!1)):_SgmntfY_._pushRequestPermissionFunc(n,a,!1))}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state, isVapid ["+n+"], isFirebase ["+a+"] "+e),_SgmntfY_._pushFadeUp(1)})}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription, isVapid ["+n+"], isFirebase ["+a+"] "+e),_SgmntfY_._pushFadeUp(1)})}},_pushRequestPermissionFunc:function(e,t,n){e?_SgmntfY_._pushRequestPermissionVapid(n):t&&_SgmntfY_._pushRequestPermission(n)},_pushFadeUp:function(e){_SgmntfY_._getJq()(".seg-popup-push").addClass("seg-fade-up"),window.setTimeout(function(){_SgmntfY_._getJq()(".seg-popup-push").remove()},e)},_pushRenderHtml:function(e,t){var n=_SgmntfY_._getMustache().render(e.html,t);_SgmntfY_._getJq()("body").prepend(n),e.css&&_SgmntfY_._getJq()("<style />").html(e.css).prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_.LOG_MESSAGE("DEBUG","Push Permission appended to html body for campaign("+e.instanceId+")")},_pushBindClickHandlers:function(e,t){_SgmntfY_._getJq()(".seg-popup-push-bttn-later-new").click(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500)}),_SgmntfY_._getJq()(".seg-popup-push-bttn-allow-new").click(function(){if(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500),e)if("Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod)_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission(t)}).catch(function(e){if("messaging/permission-blocked"===e.code){if(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission requested denied :"+e),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())}else"messaging/permission-default"===e.code?_SgmntfY_._variables.pushInfo.promptInteraction="close":(_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushBindClickHandlers() isFireBase [true]: "+e),_SgmntfY_._pushFadeUp(1))});else if("Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod){var n={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(n).then(function(e){_SgmntfY_._pushSendSubscription(e,!0,t),_SgmntfY_._variables.pushInfo.promptInteraction="granted"}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushBindClickHandlers() isVapid [true]: "+e),_SgmntfY_._pushFadeUp(1),_SgmntfY_._pushSetPromptInteractionForVapid()})}"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._variables.pushInfo.safariEnabled&&_SgmntfY_._pushGetSafariPermission()})},_pushGetSafariPermission:function(){!function e(t){if("default"===t.permission)window.safari.pushNotification.requestPermission(_SgmntfY_._variables.pushInfo.safari.packageUrl,_SgmntfY_._variables.pushInfo.safari.webPushId,{},e);else if("denied"===t.permission){if(_SgmntfY_._variables.pushInfo.promptInteraction="denied","DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())}else"granted"===t.permission&&(_SgmntfY_._variables.pushInfo.promptInteraction="granted",_SgmntfY_._pushSendSafariSubscription(t,!1))}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))},_pushShouldShowPopUp:function(){var e=bowser.name.toLowerCase(),t=parseFloat(bowser.version);return e.indexOf("chrome")>=0&&t>=80||(e.indexOf("firefox")>=0&&t>=72||(e.indexOf("opera")>=0&&t>=67||(e.indexOf("yandex")>=0&&t>=20||e.indexOf("samsung")>=0&&t>=12)))},_pushGetFirebasePermission:function(e){_SgmntfY_._variables.pushInfo.messaging.getToken().then(function(t){t&&_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(t){_SgmntfY_._pushSendSubscription(t,!1,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushGetFirebasePermission() : "+e)})}).catch(function(t){t.code&&"messaging/token-unsubscribe-failed"===t.code?_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(t){_SgmntfY_._pushSendSubscription(t,!1,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushGetFirebasePermission() : "+e)}):_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription token at _pushGetFirebasePermission() :  "+t)})},_pushRequestPermission:function(e){_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission(e)}).catch(function(e){if("messaging/permission-blocked"===e.code){if(_SgmntfY_._variables.pushInfo.promptInteraction="denied",_SgmntfY_.LOG_MESSAGE("WARN","Permission requested denied :"+e),"DENIED"!==_SgmntfY_._variables.pushInfo.subscription)return void fetch(_SgmntfY_._getPushUrl()+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent+"&device="+_SgmntfY_._variables.ua.type.toUpperCase())}else"messaging/permission-default"===e.code?_SgmntfY_._variables.pushInfo.promptInteraction="close":(_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushRequestPermission() isFireBase [true]: "+e),_SgmntfY_._pushFadeUp(1))})},_pushRequestPermissionVapid:function(e){var t={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(t).then(function(t){_SgmntfY_._pushSendSubscription(t,!0,e)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details at _pushRequestPermissionVapid() : "+e),_SgmntfY_._pushSetPromptInteractionForVapid()})},_pushSendSubscription:function(e,t,n){var a=e.endpoint.split("/").slice(-1)[0],r=e.endpoint.replace(a,"").slice(0,-1),i=e.getKey?e.getKey("auth"):"",s=e.getKey?e.getKey("p256dh"):"",o=_SgmntfY_._getUserId(),_={subscriptionId:a,auth:i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):"",key:s?btoa(String.fromCharCode.apply(null,new Uint8Array(s))):"",userId:o,agent:_SgmntfY_._variables.pushInfo.agent,endpoint:r,deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:t};_SgmntfY_._variables.pushInfo.promptInteraction="granted",fetch(_SgmntfY_._getPushUrl()+"subscription/push?apiKey="+_SgmntfY_._variables.apiKey+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&isSilent="+n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)}).then(function(e){e.ok},function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while sending subscription info to BE:  "+e)})},_pushSendSafariSubscription:function(e,t){var n={subscriptionId:e.deviceToken,auth:"",key:"",userId:_SgmntfY_._getUserId(),agent:"Safari",endpoint:"",deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:!1};fetch(_SgmntfY_._getPushUrl()+"subscription/push?apiKey="+_SgmntfY_._variables.apiKey+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&isSilent="+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){e.ok},function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while sending subscription info to BE:  "+e)})},_pushUrlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length),r=0;r<n.length;++r)a[r]=n.charCodeAt(r);return a},_pushSetPromptInteractionForVapid:function(){"Notification"in window&&("denied"===Notification.permission?_SgmntfY_._variables.pushInfo.promptInteraction="denied":"default"===Notification.permission&&(_SgmntfY_._variables.pushInfo.promptInteraction="close"))},GA:{activateTracker:function(){try{if(++_SgmntfY_._variables.ga.activateTriedCount,_SgmntfY_._variables.ga.activateTriedCount>_SgmntfY_._variables.ga.activateTryCount)return;var _tracker=eval(_SgmntfY_._variables.ga.tracker);if(_tracker){if(_tracker.loaded)if(_SgmntfY_._variables.ga.tracker=_tracker,_SgmntfY_._variables.ga.trackerName)_SgmntfY_._variables.ga.activated=!0;else for(var trackerList=_SgmntfY_._variables.ga.tracker.getAll(),i=0;i<trackerList.length;i++){var tracker=trackerList[i];if(tracker){_SgmntfY_._variables.ga.trackerName=tracker.get("name"),_SgmntfY_._variables.ga.activated=!0;break}}}else _SgmntfY_.LOG_MESSAGE("WARN","Error evaluating _SgmntfY_._variables.ga.tracker, cannot evaluate ga!")}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error evaluating _SgmntfY_._variables.ga.tracker: "+e)}},setDimension:function(e,t){_SgmntfY_._variables.ga.activated||(_SgmntfY_.GA.activateTracker(),_SgmntfY_._variables.ga.activateTriedCount<_SgmntfY_._variables.ga.activateTryCount&&_SgmntfY_.GA.setDimension(e,t));var n=_SgmntfY_._variables.ga.trackerName;n&&_SgmntfY_._variables.ga.tracker(n+".set",e,t)},setGroup:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmGroup,e),_SgmntfY_._variables.ga.activeGroup=e},setUser:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmUser,e)},setSession:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmSession,e)},setPage:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmPage,e)},setWidget:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmWidget,e)},setProduct:function(e){_SgmntfY_.GA.setDimension(_SgmntfY_._variables.ga.dimensions.sgmProduct,e)},eventCategory:function(){if(_SgmntfY_._variables.ga.activeGroup)return"Segmentify."+_SgmntfY_._variables.ga.activeGroup;if(!_SgmntfY_._variables.ga.group||"CHECK"!==_SgmntfY_._variables.ga.group){var e=_SgmntfY_._variables.ga.groups[_SgmntfY_._variables.ga.group];return e?"Segmentify."+e:"Segmentify."+_SgmntfY_._variables.ga.groups.unknown}_SgmntfY_.GA.getGroup(_SgmntfY_._getUserId(),_SgmntfY_.GA.setGroup)},convertAndSend:function(e){var t={eventCategory:e.category||_SgmntfY_.GA.eventCategory(),eventAction:e.action,eventLabel:e.label,eventValue:e.value,nonInteraction:!0};t[_SgmntfY_._variables.ga.dimensions.sgmPage]=_SgmntfY_._variables.ga.activePage,e.sgmWidget&&(t[_SgmntfY_._variables.ga.dimensions.sgmWidget]=e.sgmWidget),e.sgmProduct&&(t[_SgmntfY_._variables.ga.dimensions.sgmProduct]=e.sgmProduct),_SgmntfY_.GA.sendEvent(t)},sendEvent:function(e){if(_SgmntfY_._variables.ga.enabled){if(!e.eventCategory)return e.eventCategory=_SgmntfY_.GA.eventCategory(),void _SgmntfY_._variables.segmentifyObj("ga:event",e);_SgmntfY_._variables.ga.activated||_SgmntfY_.GA.activateTracker(),_SgmntfY_._variables.ga.activated?_SgmntfY_._variables.ga.tracker(_SgmntfY_._variables.ga.trackerName+".send","event",e):_SgmntfY_._variables.ga.activateTriedCount<_SgmntfY_._variables.ga.activateTryCount&&_SgmntfY_._variables.segmentifyObj("ga:event",e)}},sendPageView:function(e){_SgmntfY_.GA.convertAndSend({action:"Page View",label:e||_SgmntfY_._variables.ga.activePage})},sendWidgetImpression:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget Impression",label:e,sgmWidget:t})},sendWidgetView:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget View",label:e,sgmWidget:t})},sendWidgetClick:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Widget Click",label:e,sgmWidget:t})},sendArrowClick:function(e,t){_SgmntfY_.GA.convertAndSend({action:"Arrow Click",label:e,sgmWidget:t})},sendProductClick:function(e,t,n){_SgmntfY_.GA.convertAndSend({action:"Product Click",label:e,sgmWidget:t,sgmProduct:n})},sendQuickBasket:function(e,t,n){_SgmntfY_.GA.convertAndSend({action:"Quick Basket",label:e,sgmWidget:t,sgmProduct:n})},getGroup:function(e,t){if(!_SgmntfY_._variables.apiKey)return t(_SgmntfY_._variables.ga.groups.unknown);var n=_SgmntfY_._getEventUrl()+"/v2/global/user/"+_SgmntfY_._variables.apiKey+"/"+e;_SgmntfY_._getRequest(n,{},function(e){var n="REAL"===e.customObject?_SgmntfY_._variables.ga.groups.groupA:_SgmntfY_._variables.ga.groups.control;_SgmntfY_._storePersistentData(_SgmntfY_._variables.ga.groupCookie,n,1),t(n)},function(){t(_SgmntfY_._variables.ga.groups.unknown)})}},_getRequest:function(e,t,n,a){var r=new XMLHttpRequest;for(var i in r.open("GET",e,!0),r.responseType="json",r.timeout=5e3,t||{})r.setRequestHeader(i,t[i]);r.ontimeout=function(e){a()},r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)if(r.status>=200&&r.status<400){var e=r.response;try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){}n(e)}else a()},r.send()},_sourceOfUrl:function(){var e="";if(document.URL||document.referrer){if(_SgmntfY_._getQueryParameter("gclid").length)return"PAID";var t=_SgmntfY_._getQueryParameter("utm_medium");if(t.length)switch(t){case"social":e="SOCIAL";break;case"organic":e="SEARCH";break;case"cpc":case"cpm":case"ocpm":case"paid-media":case"affiliate":case"banner":case"retargeting":case"shopping":e="PAID";break;case"email":e="EMAIL"}if(!e.length){var n=document.referrer.replace("https://","").replace("http://","");-1!==(n=n.substring(0,n.indexOf("/"))).indexOf(_SgmntfY_._variables.domain)?e="INTERNAL":-1!==n.indexOf("facebook")||-1!==n.indexOf("twitter")||-1!==n.indexOf("t.co")||-1!==n.indexOf("instagram")||-1!==n.indexOf("pinterest")?e="SOCIAL":-1!==n.indexOf("google")||-1!==n.indexOf("g.co")||-1!==n.indexOf("bing")||-1!==n.indexOf("yandex")||-1!==n.indexOf("yahoo")?e="SEARCH":-1===n.indexOf("cimri.com")&&-1===n.indexOf("akakce.com")&&-1===n.indexOf("ucuzcu.com")&&-1===n.indexOf("bilio.com")&&-1===n.indexOf("auspreiser.de")&&-1===n.indexOf("billiger.de")&&-1===n.indexOf("dooyoo.de")&&-1===n.indexOf("geizhals.de")&&-1===n.indexOf("guenstiger.de")&&-1===n.indexOf("idealo.de")&&-1===n.indexOf("kelkoo.de")&&-1===n.indexOf("preis.de")&&-1===n.indexOf("preissuchmaschine.de")&&-1===n.indexOf("geizkragen.de")&&-1===n.indexOf("preisvergleich.de")&&-1===n.indexOf("preisroboter.de")&&-1===n.indexOf("vergelijk.be")&&-1===n.indexOf("pazaruvaj")&&-1===n.indexOf("nabava.net")&&-1===n.indexOf("ceneje.si")&&-1===n.indexOf("heureka")&&-1===n.indexOf("pricerunner")&&-1===n.indexOf("hinnavaatlus")&&-1===n.indexOf("skroutz.gr")&&-1===n.indexOf("agrep.hu")&&-1===n.indexOf("arukereso.hu")&&-1===n.indexOf("trovaprezzi.it")&&-1===n.indexOf("prisjakt.no")&&-1===n.indexOf("prisguiden.no")&&-1===n.indexOf("ceneo.pl")&&-1===n.indexOf("kuantokusta.pt")&&-1===n.indexOf("compari.ro")||(e="LISTING")}e.length||(e="OTHER")}return e},_enableSerializeForm:function(e){e.fn.sgmSerializeForm||(e.fn.sgmSerializeForm=function(){"use strict";var t={};return e.each(this.serializeArray(),function(n,a){var r=t[a.name];null!=r?e.isArray(r)?r.push(a.value):t[a.name]=[r,a.value]:t[a.name]=a.value}),e.each(t,function(n,a){null!=a&&e.isArray(a)&&(t[n]=a.join())}),t})},init:function(){_SgmntfY_._variables.namespace=window.SegmentifyTrackingObject,_SgmntfY_._variables.segmentifyObj=window[_SgmntfY_._variables.namespace];var e=_SgmntfY_._getQueryParameter("_sgm_tracking");if(_SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),"disabled"!==_SgmntfY_._getTracking())if(_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj)&&_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj.q)){if(_SgmntfY_._variables.initTimer&&window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_.modernize(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify is loading... ***"),_SgmntfY_._extend(!0,_SgmntfY_._variables,_SgmntfY_._variables.segmentifyObj.config),_SgmntfY_._functions.setLogLevel(_SgmntfY_._variables.logLevel),!(_SgmntfY_._variables.domain&&document.URL.indexOf(_SgmntfY_._variables.domain)>=0))return void console.error("Segmentify domain is not set properly: "+_SgmntfY_._variables.domain);if(window.onunload=_SgmntfY_._windowUnload,null==_SgmntfY_._variables.jq)_SgmntfY_._loadJavascript(_SgmntfY_._variables.jQueryUrl,!0,function(){_SgmntfY_._variables.jq=jQuery.noConflict(!0),_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode(),_SgmntfY_._setQaMode(),_SgmntfY_._setSearchBetaMode()});else{if(!_SgmntfY_._checkVersion("1.7",_SgmntfY_._variables.jq.fn.jquery))return void console.error("Segmentify requires jQuery version >= 1.7");_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode(),_SgmntfY_._setQaMode(),_SgmntfY_._setSearchBetaMode()}null==_SgmntfY_._variables.mustache&&(_SgmntfY_._variables.mustache={},initializeMustache(_SgmntfY_._variables.mustache),_SgmntfY_._variables.mustache.tags=["[[","]]"]),_SgmntfY_._updateBrowserAndDeviceInfo(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Running on a "+_SgmntfY_._variables.ua.type+" ***"),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify loaded and started... ***"),_SgmntfY_.run(),_SgmntfY_._dispatchInitEvent()}else{if(++_SgmntfY_._variables.initTryCount,_SgmntfY_._variables.initTryCount>_SgmntfY_._variables.initTryLimit)return void window.clearTimeout(_SgmntfY_._variables.initTimer);window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_._variables.initTimer=window.setTimeout(_SgmntfY_.init,100)}else _SgmntfY_.LOG_MESSAGE("DEBUG","End-user opted-out Segmentify tracking!")},_initializeDelayedActions:function(){try{var e=_SgmntfY_._getDelayedActions();_SgmntfY_._setDelayedActions([]);for(var t=new Date,n=0;n<e.length;n++)e[n].delayDate=new Date(e[n].delayDate),e[n].delayDate.getTime()>t.getTime()&&_SgmntfY_._addDelayedAction(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed actions: "+e)}},_initializeDelayedCampaigns:function(){try{var e=_SgmntfY_._getDelayedCampaigns();_SgmntfY_._setDelayedCampaigns([]);for(var t=new Date,n=0;n<e.length;++n)e[n].time=new Date(e[n].time),e[n].time.getTime()>t.getTime()&&_SgmntfY_._addDelayedCampaign(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed campaigns: "+e)}},_dispatchInitEvent:function(){try{if(window.dispatchEvent){var e={testMode:_SgmntfY_._getTestMode(),qaMode:_SgmntfY_._getQaMode(),searchBetaMode:_SgmntfY_._getSearchBetaMode()};window.dispatchEvent(new CustomEvent("segmentifyInited",{detail:e}))}}catch(e){}},_ajaxError:function(e,t,n,a){_SgmntfY_.LOG_MESSAGE("WARN","Error in sending event:\nEvent Data: "+JSON.stringify(e.data)+"\nResponse: "+t.responseText+"\nStatus: "+n+"\nError: "+a)},_ajaxSuccess:function(e,t,n){_SgmntfY_.LOG_MESSAGE("DEBUG","Success in sending event:\nEvent Data: "+JSON.stringify(e)+"\nStatus: "+n+"\nResponse Data: "+JSON.stringify(t))},_windowUnload:function(){_SgmntfY_._variables.isUnload=!0,window.clearTimeout(_SgmntfY_._variables.runTimer);for(var e=[];_SgmntfY_._variables.segmentifyObj.q.length>0;)try{var t=_SgmntfY_._variables.segmentifyObj.q.shift(),n=_SgmntfY_._functions.getFunction(t[0]),a=Array.prototype.slice.call(t,1);(i=n.apply(null,a)).originalParams.discardResponse="true",e.push(i)}catch(e){}for(var r=_SgmntfY_._getRetryQueue();r.length>0;)try{var i;(i=r.shift()).originalParams.discardResponse="true",e.push(i)}catch(e){}_SgmntfY_._setRetryQueue(e)},run:function(){try{if(_SgmntfY_._variables.jq&&(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0||_SgmntfY_._getDataLayer())&&!_SgmntfY_._variables.waitingKeys&&_SgmntfY_._variables.keysTryCount<5){var e=0,t=_SgmntfY_._getUserId(),n=_SgmntfY_._getSessionId();if(_SgmntfY_._isEmpty(t)?e=2:_SgmntfY_._isEmpty(n)?e=1:_SgmntfY_._isNotEmpty(n)&&_SgmntfY_._variables.segmentifyObj.q.length>0&&(_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,n,0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,t,390,_SgmntfY_._variables.storage.user.local)),e>0)_SgmntfY_._updateUserAndSessionId(e);else{if(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0){var a=_SgmntfY_._variables.segmentifyObj.q.splice(0,_SgmntfY_._variables.segmentifyObj.q.length);_SgmntfY_._functions.callFunction(a)}_SgmntfY_._getDataLayer()&&_SgmntfY_._consumeDataLayer()}}window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in run: "+e),window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}},modernize:function(){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=a)return-1;for(var i=Math.max(r>=0?r:a-Math.abs(r),0);i<a;){if(i in n&&n[i]===e)return i;i++}return-1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,a,r;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),a=new Array(s),r=0;r<s;){var o,_;r in i&&(o=i[r],_=e.call(n,o,r,i),a[r]=_),r++}return a});var e=JSON.stringify;if(JSON.stringify=function(t,n,a){var r=Array.prototype.toJSON,i=Number.prototype.toJSON,s=String.prototype.toJSON;delete Number.prototype.toJSON,delete Array.prototype.toJSON,delete String.prototype.toJSON;var o=void 0;try{o=e(t,n,a)}catch(e){o=void 0}return r&&(Array.prototype.toJSON=r),i&&(Number.prototype.toJSON=i),s&&(String.prototype.toJSON=s),o},"function"!=typeof window.CustomEvent){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}},LOG_MESSAGE:function(e,t){var n=_SgmntfY_._variables.logLevel,a=_SgmntfY_.LOG_LEVELS[e];void 0!==a&&a<=n&&console.log("Segmentify["+e+"]: "+t)}};_SgmntfY_.init()}(window);