var featuredimagezoomer={loadinggif:"",magnifycursor:"crosshair"};(function($){$("head").append('<style type="text/css">.featuredimagezoomerhidden {visibility: hidden!important;}</style>'),$.fn.multizoomhide=function(){return $('<style type="text/css">'+this.selector+" {visibility: hidden;}</style>").appendTo("head")};var initcount=0,itag,iname;$.fn.addmultizoom=function(options){var indoptions={largeimage:options.largeimage},$imgObj=$(options.imgObj+':not(".thumbs")'),$descArea=$(options.descArea),first=!0,splitre=/, ?/;function loadfunction(){var e,t,i,o,a=this,s={},r={};(e=a.getAttribute("data-dims"))&&(e=e.split(splitre),e[0],o=e[1]),$(new Image).on("error",(function(){a.tagName&&!options.notmulti&&(alert("Error: I couldn't find the image:\n\n"+a.href+((t=a.getAttribute("data-title"))?'\n\n"'+t+'"':"")),(i=$imgObj.data("last-trigger"))&&(first=!0,$(i).trigger("click")))})).on("load",(function(){var e,t=$imgObj.css("opacity"),i={};isNaN(t)&&(t=1),!options.notmulti&&indoptions.largeimage||(options.width||$imgObj.width(),o=options.height||$imgObj.height()),$imgObj.data("added")&&$imgObj.data("added").remove(),$imgObj.data("last-trigger",a),options.imagevertcenter&&(s={top:($imgObj.parent().innerHeight()-o)/2}),$imgObj.css(s).addimagezoom($.extend(i,options,indoptions)).data("added",$(".magnifyarea:last"+(i.cursorshade?", .cursorshade:last":"")+", .zoomstatus:last, .zoomtracker:last")),options.magvertcenter&&$(".magnifyarea:last").css({marginTop:(o-$(".magnifyarea:last").height())/2}),options.descpos&&(e=$imgObj.parent(),r={left:e.offset().left+(e.outerWidth()-e.width())/2,top:o+$imgObj.offset().top}),options.notmulti?$descArea.css(r):$descArea.css(r).empty().append(a.getAttribute("data-title")||""),+t<1&&$imgObj.add($descArea).animate({opacity:1},options.speed)})).attr("src",$imgObj.data("src"))}return options=$.extend({speed:"slow",initzoomablefade:!0,zoomablefade:!0,preventinitlooplimit:options.preventinitlooplimit||10},options),this.on("click",(function(e){e.preventDefault();var src=$imgObj.attr("src"),ms,zr,cs,opacityObj={opacity:0};(first||src!==this.href&&src!==this.getAttribute("href"))&&((first&&!options.initzoomablefade||!options.zoomablefade)&&(opacityObj={}),first=!1,indoptions.largeimage=this.getAttribute("data-large")||options.largeimage||"","none"===indoptions.largeimage&&(indoptions.largeimage=""),(ms=this.getAttribute("data-magsize"))||options.magnifiersize?indoptions.magnifiersize=(ms?ms.split(splitre):"")||options.magnifiersize:delete indoptions.magnifiersize,indoptions.zoomrange=((zr=this.getAttribute("data-zoomrange"))?zr=zr.split(splitre):"")||options.zoomrange||"",zr&&(zr[0]=+zr[0],zr[1]=+zr[1]),indoptions.cursorshade=((cs=this.getAttribute("data-lens"))?cs:"")||options.cursorshade||"",cs&&(indoptions.cursorshade=eval(cs)),$imgObj.data("added")&&$imgObj.stop(!0,!0).data("added").not(".zoomtracker").remove().end().css({background:"url("+featuredimagezoomer.loadinggif+") center no-repeat"}),$imgObj.css($.extend({visibility:"visible"},$imgObj.data("added")&&options.zoomablefade?{opacity:.25}:opacityObj)).data("src",this.href),"absolute"==$descArea.css("position")&&$(document.body).append($descArea),$descArea.css($.extend({visibility:"visible"},opacityObj)),loadfunction.call(this))})).eq(0).trigger("click"),this},$.extend(featuredimagezoomer,{dsetting:{magnifierpos:"right",magnifiersize:[200,200],cursorshadecolor:"#fff",cursorshadeopacity:.3,cursorshadeborder:"1px solid black",cursorshade:!1,leftoffset:15,rightoffset:10},isie:!1,showimage:function(e,t,i){var o=e.data("specs"),a=o.magpos,s=e.data("specs").coords;o.windimensions={w:$(window).width(),h:$(window).height()};var r={};r.left=s.left+("left"===a?-o.magsize.w-o.lo:e.width()+o.ro),"right"===a&&r.left+o.magsize.w+o.lo>=o.windimensions.w&&s.left-o.magsize.w>=o.lo?r.left=s.left-o.magsize.w-o.lo:"left"===a&&r.left<o.ro?r.left=s.left+e.width():r.left=s.left,t.css({left:r.left,top:s.top}).show(),o.$statusdiv.html("Current Zoom: "+o.curpower+'<div style="font-size:80%">Use Mouse Wheel to Zoom In/Out</div>'),i&&this.showstatusdiv(o,400,2e3)},hideimage:function(e,t,i){var o=e.data("specs");t.hide(),i&&this.hidestatusdiv(o)},showstatusdiv:function(e,t,i){clearTimeout(e.statustimer),e.$statusdiv.css({visibility:"visible"}).fadeIn(t),e.statustimer=setTimeout((function(){featuredimagezoomer.hidestatusdiv(e)}),i)},hidestatusdiv:function(e){e.$statusdiv.stop(!0,!0).hide()},getboundary:function(e,t,i){if("left"==e){var o=-i.imagesize.w*i.curpower+i.magsize.w;return t>0?0:t<o?o:t}var a=-i.imagesize.h*i.curpower+i.magsize.h;return t>0?0:t<a?a:t},moveimage:function(e,t,i,o){var a=e.data("specs"),s=Math.round(a.magsize.w/a.curpower),r=Math.round(a.magsize.h/a.curpower),n=a.csborder,d=a.coords,m=o.pageX||a.lastpagex,l=o.pageY||a.lastpagey,g=m-d.left,c=l-d.top;i.css({visibility:"",width:s,height:r,top:Math.min(a.imagesize.h-r-n,Math.max(0,c-(n+r)/2))+d.top,left:Math.min(a.imagesize.w-s-n,Math.max(0,g-(n+s)/2))+d.left});var u=-g*a.curpower+a.magsize.w/2,p=-c*a.curpower+a.magsize.h/2;t.css({left:this.getboundary("left",u,a),top:this.getboundary("top",p,a)}),a.$statusdiv.css({left:m-10,top:l+20}),a.lastpagex=m,a.lastpagey=l},magnifyimage:function(e,t,i){t.detail||t.wheelDelta||(t=t.originalEvent);var o=(t.detail?-120*t.detail:t.wheelDelta)<=-120?"out":"in",a=e.data("specs"),s=a.magnifier,r=a.imagesize,n=a.curpower,d="in"==o?Math.min(n+1,i[1]):Math.max(n-1,i[0]),m=[r.w*d,r.h*d];s.$image.css({width:m[0],height:m[1]}),a.curpower=d,a.$statusdiv.html("Current Zoom: "+a.curpower),this.showstatusdiv(a,0,500),e.trigger("mousemove")},highestzindex:function(e){var t,i=0;return e.parents().add(e).each((function(){t=$(this).css("zIndex"),t=isNaN(t)?0:+t,i=Math.max(i,t)})),i},init:function(e,t){var i,o,a,s,r=$.extend({},this.dsetting,t),n=e.width(),d=e.height(),m=e.offset(),l=this,g={pageX:0,pageY:0},c=r.zIndex||this.highestzindex(e);if(0===d||0===n){if(e&&!e.is(":visible"))return;return initcount>=t.preventinitlooplimit?void console.warn("Prevented Multizoom initialisation loop after "+initcount+" iterations"):(initcount++,void $(new Image).on("load",(function(){featuredimagezoomer.init(e,t)})).attr("src",e.attr("src")))}function u(){var e=i.offset();return{left:e.left,top:e.top}}e.css({visibility:"visible"}),r.largeimage=r.largeimage||e.get(0).src,s=$('<div class="magnifyarea" style="position:absolute;z-index:'+c+";width:"+r.magnifiersize[0]+"px;height:"+r.magnifiersize[1]+'px;left:-10000px;top:-10000px;visibility:hidden;overflow:hidden;border:none;" />').append('<div style="position:relative;left:0;top:0;z-index:'+c+';" />').appendTo(document.body),o=r.cursorshade?$('<div class="cursorshade" style="visibility:hidden;position:absolute;left:0;top:0;z-index:'+c+';" />').css({border:r.cursorshadeborder,opacity:r.cursorshadeopacity,backgroundColor:r.cursorshadecolor}).appendTo(document.body):$("<div />"),a=$('<div class="zoomstatus preloadevt" style="position:absolute;visibility:hidden;left:0;top:0;z-index:'+c+';" />').html('<img src="'+this.loadinggif+'" />').appendTo(document.body),i=$('<div class="zoomtracker" style="cursor:progress;position:absolute;z-index:'+c+";left:"+m.left+"px;top:"+m.top+"px;height:"+d+"px;width:"+n+'px;" />').css({backgroundImage:this.isie?"url(cannotbe)":"none"}).appendTo(document.body),$(window).on("load resize",(function(){var o,a=e.offset();i.css({left:a.left,top:a.top}),t.descpos&&t.descArea&&(o=e.parent(),$(t.descArea).css({left:o.offset().left+(o.outerWidth()-o.width())/2,top:e.height()+a.top}))})),i.on("mouseover",(function(e){o.add(s).add(a).removeClass("featuredimagezoomerhidden"),i.data("premouseout",!1)})).on("mouseout",(function(e){o.add(s).add(a.not(".preloadevt")).addClass("featuredimagezoomerhidden"),i.data("premouseout",!0)})).on("mousemove",(function(e){g.pageX=e.pageX,g.pageY=e.pageY})),i.one("mouseover",(function(t){var m=s.find("div:eq(0)"),c=$('<img src="'+r.largeimage+'"/>').appendTo(m),p=featuredimagezoomer.loaded[$('<a href="'+r.largeimage+'"></a>').get(0).href],f=r.zoomrange&&r.zoomrange[1]>r.zoomrange[0],h=u();p||(e.stop(!0,!0).css({opacity:.1}),a.css({left:h.left+n/2-a.width()/2,top:h.top+d/2-a.height()/2,visibility:"visible"})),c.on("loadevt",(function(t,p){if("error"!==p.type){if(featuredimagezoomer.loaded[this.src]=!0,e.css({opacity:1}),a.empty().css({border:"1px solid black",background:"#C0C0C0",padding:"4px",font:"bold 13px Arial",opacity:.8}).hide().removeClass("preloadevt"),i.data("premouseout")&&a.addClass("featuredimagezoomerhidden"),r.zoomrange){var h=[n*r.zoomrange[0],d*r.zoomrange[0]];c.css({width:h[0],height:h[1]})}!function(e,t){var m={w:s.width(),h:s.height()},l={w:n,h:d},g=r.zoomrange?r.zoomrange[0]:(t.width()/n).toFixed(5);i.data("specs",{$statusdiv:a,statustimer:null,magnifier:{$outer:s,$inner:e,$image:t},magsize:m,magpos:r.magnifierpos,imagesize:l,curpower:g,coords:u(),csborder:o.outerWidth(),lo:r.leftoffset,ro:r.rightoffset})}(m,c),s.css({display:"none",visibility:"visible"}),i.on("mouseover",(function(e){i.data("specs").coords=u(),l.showimage(i,s,f)})),i.on("mousemove",(function(e){l.moveimage(i,m,o,e)})),i.data("premouseout")||(l.showimage(i,s,f),l.moveimage(i,m,o,g)),i.on("mouseout",(function(e){l.hideimage(i,s,f)})).css({cursor:l.magnifycursor}),r.zoomrange&&r.zoomrange[1]>r.zoomrange[0]?i.bind("DOMMouseScroll mousewheel",(function(e){l.magnifyimage(i,e,r.zoomrange),e.preventDefault()})):r.disablewheel&&i.bind("DOMMouseScroll mousewheel",(function(e){e.preventDefault()}))}else{e.css({opacity:1}).data("added").remove();var z=$('<a href="'+c.attr("src")+'"></a>').get(0).href;window.console&&console.error?console.error("Cannot find Featured Image Zoomer larger image: "+z):alert("Cannot find Featured Image Zoomer larger image:\n\n"+z)}})),c.get(0).complete?c.trigger("loadevt",{type:"load"}):c.on("load error",(function(e){c.trigger("loadevt",e)}))}))},iname:(itag=$("<img />"),iname=itag.get(0).tagName,itag.remove(),iname),loaded:{},hashre:/^#/}),$.fn.addimagezoom=function(e){var t=e.selector?e.selector:$(this).attr("id"),i=$(t.replace(featuredimagezoomer.hashre,".")+".thumbs a");return null!==(e=e||{}).multizoom&&i.length?(i.addmultizoom($.extend(e,{imgObj:t,multizoom:null})),this):e.multizoom?($(e.multizoom).addmultizoom($.extend(e,{imgObj:t,multizoom:null})),this):null!==e.multizoom?this.each((function(){if(this.tagName!==featuredimagezoomer.iname)return!0;$('<a href="'+this.src+'"></a>').addmultizoom($.extend(e,{imgObj:t,multizoom:null,notmulti:!0}))})):this.each((function(){if(this.tagName!==featuredimagezoomer.iname)return!0;featuredimagezoomer.init($(this),e)}))}})(jQuery);